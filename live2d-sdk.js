(()=>{var _=class a{constructor(e=0){e<1?(this._ptr=[],this._capacity=0,this._size=0):(this._ptr=new Array(e),this._capacity=e,this._size=0)}at(e){return this._ptr[e]}set(e,t){this._ptr[e]=t}get(e=0){let t=new Array;for(let i=e;i<this._size;i++)t.push(this._ptr[i]);return t}pushBack(e){this._size>=this._capacity&&this.prepareCapacity(this._capacity==0?a.DefaultSize:this._capacity*2),this._ptr[this._size++]=e}clear(){this._ptr.length=0,this._size=0}getSize(){return this._size}assign(e,t){this._size<e&&this.prepareCapacity(e);for(let r=0;r<e;r++)this._ptr[r]=t;this._size=e}resize(e,t=null){this.updateSize(e,t,!0)}updateSize(e,t=null,i=!0){if(this._size<e)if(this.prepareCapacity(e),i)for(let s=this._size;s<e;s++)typeof t=="function"?this._ptr[s]=JSON.parse(JSON.stringify(new t)):this._ptr[s]=t;else for(let s=this._size;s<e;s++)this._ptr[s]=t;else{let s=this._size-e;this._ptr.splice(this._size-s,s)}this._size=e}insert(e,t,i){let r=e._index,s=t._index,o=i._index,n=o-s;this.prepareCapacity(this._size+n);let u=this._size-r;if(u>0)for(let m=0;m<u;m++)this._ptr.splice(r+m,0,null);for(let m=s;m<o;m++,r++)this._ptr[r]=t._vector._ptr[m];this._size=this._size+n}remove(e){return e<0||this._size<=e?!1:(this._ptr.splice(e,1),--this._size,!0)}erase(e){let t=e._index;return t<0||this._size<=t?e:(this._ptr.splice(t,1),--this._size,new xe(this,t))}prepareCapacity(e){e>this._capacity&&(this._capacity==0?(this._ptr=new Array(e),this._capacity=e):(this._ptr.length=e,this._capacity=e))}begin(){return this._size==0?this.end():new xe(this,0)}end(){return new xe(this,this._size)}getOffset(e){let t=new a;return t._ptr=this.get(e),t._size=this.get(e).length,t._capacity=this.get(e).length,t}static{this.DefaultSize=10}},xe=class a{constructor(e,t){this._vector=e??null,this._index=t??0}set(e){return this._index=e._index,this._vector=e._vector,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new a(this._vector,this._index++)}decrement(){return new a(this._vector,this._index--)}ptr(){return this._vector._ptr[this._index]}substitution(e){return this._index=e._index,this._vector=e._vector,this}notEqual(e){return this._index!=e._index||this._vector!=e._vector}},Vr;(t=>(t.csmVector=_,t.iterator=xe))(Vr||={});var D=class{append(e,t){return this.s+=t!==void 0?e.substr(0,t):e,this}expansion(e,t){for(let i=0;i<e;i++)this.append(t);return this}getBytes(){return encodeURIComponent(this.s).replace(/%../g,"x").length}getLength(){return this.s.length}isLess(e){return this.s<e.s}isGreat(e){return this.s>e.s}isEqual(e){return this.s==e}isEmpty(){return this.s.length==0}constructor(e){this.s=e}},Br;(e=>e.csmString=D)(Br||={});var Le=class a{static createIdInternal(e){return new a(e)}getString(){return this._id}isEqual(e){return typeof e=="string"?this._id.isEqual(e):e instanceof D?this._id.isEqual(e.s):e instanceof a?this._id.isEqual(e._id.s):!1}isNotEqual(e){return typeof e=="string"?!this._id.isEqual(e):e instanceof D?!this._id.isEqual(e.s):e instanceof a?!this._id.isEqual(e._id.s):!1}constructor(e){if(typeof e=="string"){this._id=new D(e);return}this._id=e}},Er;(e=>e.CubismId=Le)(Er||={});var De=class{constructor(){this._ids=new _}release(){for(let e=0;e<this._ids.getSize();++e)this._ids.set(e,void 0);this._ids=null}registerIds(e){for(let t=0;t<e.length;t++)this.registerId(e[t])}registerId(e){let t=null;if(typeof e=="string"){if((t=this.findId(e))!=null)return t;t=Le.createIdInternal(e),this._ids.pushBack(t)}else return this.registerId(e.s);return t}getId(e){return this.registerId(e)}isExist(e){return typeof e=="string"?this.findId(e)!=null:this.isExist(e.s)}findId(e){for(let t=0;t<this._ids.getSize();++t)if(this._ids.at(t).getString().isEqual(e))return this._ids.at(t);return null}},Fr;(e=>e.CubismIdManager=De)(Fr||={});var A=class a{constructor(){this._tr=new Float32Array(16),this.loadIdentity()}static multiply(e,t,i){let r=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),s=4;for(let o=0;o<s;++o)for(let n=0;n<s;++n)for(let u=0;u<s;++u)r[n+o*4]+=e[u+o*4]*t[n+u*4];for(let o=0;o<16;++o)i[o]=r[o]}loadIdentity(){let e=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(e)}setMatrix(e){for(let t=0;t<16;++t)this._tr[t]=e[t]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(e){return this._tr[0]*e+this._tr[12]}transformY(e){return this._tr[5]*e+this._tr[13]}invertTransformX(e){return(e-this._tr[12])/this._tr[0]}invertTransformY(e){return(e-this._tr[13])/this._tr[5]}translateRelative(e,t){let i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,e,t,0,1]);a.multiply(i,this._tr,this._tr)}translate(e,t){this._tr[12]=e,this._tr[13]=t}translateX(e){this._tr[12]=e}translateY(e){this._tr[13]=e}scaleRelative(e,t){let i=new Float32Array([e,0,0,0,0,t,0,0,0,0,1,0,0,0,0,1]);a.multiply(i,this._tr,this._tr)}scale(e,t){this._tr[0]=e,this._tr[5]=t}multiplyByMatrix(e){a.multiply(e.getArray(),this._tr,this._tr)}clone(){let e=new a;for(let t=0;t<this._tr.length;t++)e._tr[t]=this._tr[t];return e}},Rr;(e=>e.CubismMatrix44=A)(Rr||={});var se=class{constructor(e,t,i,r){this.x=e,this.y=t,this.width=i,this.height=r}getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(e){this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height}expand(e,t){this.x-=e,this.y-=t,this.width+=e*2,this.height+=t*2}},Dr;(e=>e.csmRect=se)(Dr||={});var ae=class{static create(){return null}static delete(e){e=null}initialize(e){this._model=e}drawModel(){this.getModel()!=null&&(this.saveProfile(),this.doDrawModel(),this.restoreProfile())}setMvpMatrix(e){this._mvpMatrix4x4.setMatrix(e.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(e,t,i,r){e<0?e=0:e>1&&(e=1),t<0?t=0:t>1&&(t=1),i<0?i=0:i>1&&(i=1),r<0?r=0:r>1&&(r=1),this._modelColor.r=e,this._modelColor.g=t,this._modelColor.b=i,this._modelColor.a=r}getModelColor(){return JSON.parse(JSON.stringify(this._modelColor))}getModelColorWithOpacity(e){let t=this.getModelColor();return t.a*=e,this.isPremultipliedAlpha()&&(t.r*=t.a,t.g*=t.a,t.b*=t.a),t}setIsPremultipliedAlpha(e){this._isPremultipliedAlpha=e}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(e){this._isCulling=e}isCulling(){return this._isCulling}setAnisotropy(e){this._anisotropy=e}getAnisotropy(){return this._anisotropy}getModel(){return this._model}useHighPrecisionMask(e){this._useHighPrecisionMask=e}isUsingHighPrecisionMask(){return this._useHighPrecisionMask}constructor(){this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisotropy=0,this._model=null,this._modelColor=new N,this._useHighPrecisionMask=!1,this._mvpMatrix4x4=new A,this._mvpMatrix4x4.loadIdentity()}},ft=(i=>(i[i.CubismBlendMode_Normal=0]="CubismBlendMode_Normal",i[i.CubismBlendMode_Additive=1]="CubismBlendMode_Additive",i[i.CubismBlendMode_Multiplicative=2]="CubismBlendMode_Multiplicative",i))(ft||{}),N=class{constructor(e=1,t=1,i=1,r=1){this.r=e,this.g=t,this.b=i,this.a=r}},wt=class{constructor(e,t){this._clippingIdList=e,this._clippingIdCount=t,this._allClippedDrawRect=new se,this._layoutBounds=new se,this._clippedDrawableIndexList=[],this._matrixForMask=new A,this._matrixForDraw=new A,this._bufferIndex=0}release(){this._layoutBounds!=null&&(this._layoutBounds=null),this._allClippedDrawRect!=null&&(this._allClippedDrawRect=null),this._clippedDrawableIndexList!=null&&(this._clippedDrawableIndexList=null)}addClippedDrawable(e){this._clippedDrawableIndexList.push(e)}},Nr;(i=>(i.CubismBlendMode=ft,i.CubismRenderer=ae,i.CubismTextureColor=N))(Nr||={});var Xr=(a,e,t)=>{Me.print(a,"[CSM]"+e,t)},H=(a,e,t)=>{Xr(a,e+`
`,t)},z=a=>{console.assert(a)},Wr,le,U,W,B;Wr=(a,...e)=>{H(0,"[V]"+a,e)},le=(a,...e)=>{H(1,"[D]"+a,e)},U=(a,...e)=>{H(2,"[I]"+a,e)},W=(a,...e)=>{H(3,"[W]"+a,e)},B=(a,...e)=>{H(4,"[E]"+a,e)};var Me=class{static print(e,t,i){if(e<v.getLoggingLevel())return;let r=v.coreLogFunction;if(!r)return;let s=t.replace(/\{(\d+)\}/g,(o,n)=>i[n]);r(s)}static dumpBytes(e,t,i){for(let r=0;r<i;r++)r%16==0&&r>0?this.print(e,`
`):r%8==0&&r>0&&this.print(e,"  "),this.print(e,"{0} ",[t[r]&255]);this.print(e,`
`)}constructor(){}},Yr;(e=>e.CubismDebug=Me)(Yr||={});var yt=class{constructor(e,t){this.first=e??null,this.second=t??null}},k=class a{constructor(e){e!=null?e<1?(this._keyValues=[],this._dummyValue=null,this._size=0):(this._keyValues=new Array(e),this._size=e):(this._keyValues=[],this._dummyValue=null,this._size=0)}release(){this.clear()}appendKey(e){this.prepareCapacity(this._size+1,!1),this._keyValues[this._size]=new yt(e),this._size+=1}getValue(e){let t=-1;for(let i=0;i<this._size;i++)if(this._keyValues[i].first==e){t=i;break}return t>=0?this._keyValues[t].second:(this.appendKey(e),this._keyValues[this._size-1].second)}setValue(e,t){let i=-1;for(let r=0;r<this._size;r++)if(this._keyValues[r].first==e){i=r;break}i>=0?this._keyValues[i].second=t:(this.appendKey(e),this._keyValues[this._size-1].second=t)}isExist(e){for(let t=0;t<this._size;t++)if(this._keyValues[t].first==e)return!0;return!1}clear(){this._keyValues=void 0,this._keyValues=null,this._keyValues=[],this._size=0}getSize(){return this._size}prepareCapacity(e,t){e>this._keyValues.length&&(this._keyValues.length==0?(!t&&e<a.DefaultSize&&(e=a.DefaultSize),this._keyValues.length=e):(!t&&e<this._keyValues.length*2&&(e=this._keyValues.length*2),this._keyValues.length=e))}begin(){return new Se(this,0)}end(){return new Se(this,this._size)}erase(e){let t=e._index;return t<0||this._size<=t?e:(this._keyValues.splice(t,1),--this._size,new Se(this,t))}dumpAsInt(){for(let e=0;e<this._size;e++)le("{0} ,",this._keyValues[e]),le(`
`)}static{this.DefaultSize=10}},Se=class a{constructor(e,t){this._map=e??new k,this._index=t??0}set(e){return this._index=e._index,this._map=e._map,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new a(this._map,this._index++)}decrement(){let e=new a(this._map,this._index);return this._map=e._map,this._index=e._index,this}ptr(){return this._map._keyValues[this._index]}notEqual(e){return this._index!=e._index||this._map!=e._map}},jr;(i=>(i.csmMap=k,i.csmPair=yt,i.iterator=Se))(jr||={});var Ft=class a{static parseJsonObject(e,t){return Object.keys(e).forEach(i=>{if(typeof e[i]=="boolean"){let r=!!e[i];t.put(i,new X(r))}else if(typeof e[i]=="string"){let r=String(e[i]);t.put(i,new ie(r))}else if(typeof e[i]=="number"){let r=Number(e[i]);t.put(i,new me(r))}else e[i]instanceof Array?t.put(i,a.parseJsonArray(e[i])):e[i]instanceof Object?t.put(i,a.parseJsonObject(e[i],new te)):e[i]==null?t.put(i,new ee):t.put(i,e[i])}),t}static parseJsonArray(e){let t=new Pe;return Object.keys(e).forEach(i=>{if(typeof Number(i)=="number")if(typeof e[i]=="boolean"){let s=!!e[i];t.add(new X(s))}else if(typeof e[i]=="string"){let s=String(e[i]);t.add(new ie(s))}else if(typeof e[i]=="number"){let s=Number(e[i]);t.add(new me(s))}else e[i]instanceof Array?t.add(this.parseJsonArray(e[i])):e[i]instanceof Object?t.add(this.parseJsonObject(e[i],new te)):e[i]==null?t.add(new ee):t.add(e[i]);else if(e[i]instanceof Array)t.add(this.parseJsonArray(e[i]));else if(e[i]instanceof Object)t.add(this.parseJsonObject(e[i],new te));else if(e[i]==null)t.add(new ee);else{let s=Array(e[i]);for(let o=0;o<s.length;o++)t.add(s[o])}}),t}};var At="Error: type mismatch",Kr="Error: index out of bounds",O=class a{constructor(){}getRawString(e,t){return this.getString(e,t)}toInt(e=0){return e}toFloat(e=0){return e}toBoolean(e=!1){return e}getSize(){return 0}getArray(e=null){return e}getVector(e=new _){return e}getMap(e){return e}getValueByIndex(e){return a.errorValue.setErrorNotForClientCall(At)}getValueByString(e){return a.nullValue.setErrorNotForClientCall(At)}getKeys(){return a.dummyKeys}isError(){return!1}isNull(){return!1}isBool(){return!1}isFloat(){return!1}isString(){return!1}isArray(){return!1}isMap(){return!1}equals(e){return!1}isStatic(){return!1}setErrorNotForClientCall(e){return ce.errorValue}static staticInitializeNotForClientCall(){X.trueValue=new X(!0),X.falseValue=new X(!1),a.errorValue=new ce("ERROR",!0),a.nullValue=new ee,a.dummyKeys=new _}static staticReleaseNotForClientCall(){X.trueValue=null,X.falseValue=null,a.errorValue=null,a.nullValue=null,a.dummyKeys=null}},L=class a{constructor(e,t){this._parseCallback=Ft.parseJsonObject;this._error=null,this._lineCount=0,this._root=null,e!=null&&this.parseBytes(e,t,this._parseCallback)}static create(e,t){let i=new a;return i.parseBytes(e,t,i._parseCallback)?i:(a.delete(i),null)}static delete(e){e=null}getRoot(){return this._root}static arrayBufferToString(e){let t=new Uint8Array(e),i="";for(let r=0,s=t.length;r<s;++r)i+="%"+this.pad(t[r].toString(16));return i=decodeURIComponent(i),i}static pad(e){return e.length<2?"0"+e:e}parseBytes(e,t,i){let r=new Array(1),s=a.arrayBufferToString(e);if(i==null?this._root=this.parseValue(s,t,0,r):this._root=i(JSON.parse(s),new te),this._error){let o="\0";return o="Json parse error : @line "+(this._lineCount+1)+`
`,this._root=new ie(o),U("{0}",this._root.getRawString()),!1}else if(this._root==null)return this._root=new ce(new D(this._error),!1),!1;return!0}getParseError(){return this._error}checkEndOfFile(){return this._root.getArray()[1].equals("EOF")}parseValue(e,t,i,r){if(this._error)return null;let s=null,o=i,n;for(;o<t;o++)switch(e[o]){case"-":case".":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{let m=new Array(1);return n=Di(e.slice(o),m),r[0]=e.indexOf(m[0]),new me(n)}case'"':return new ie(this.parseString(e,t,o+1,r));case"[":return s=this.parseArray(e,t,o+1,r),s;case"{":return s=this.parseObject(e,t,o+1,r),s;case"n":return o+3<t?(s=new ee,r[0]=o+4):this._error="parse null",s;case"t":return o+3<t?(s=X.trueValue,r[0]=o+4):this._error="parse true",s;case"f":return o+4<t?(s=X.falseValue,r[0]=o+5):this._error="illegal ',' position",s;case",":return this._error="illegal ',' position",null;case"]":return r[0]=o,null;case`
`:this._lineCount++;case" ":case"	":case"\r":default:break}return this._error="illegal end of value",null}parseString(e,t,i,r){if(this._error)return null;if(!e)return this._error="string is null",null;let s=i,o,n,u=new D(""),m=i;for(;s<t;s++)switch(o=e[s],o){case'"':return r[0]=s+1,u.append(e.slice(m),s-m),u.s;case"//":if(s++,s-1>m&&u.append(e.slice(m),s-m),m=s+1,s<t)switch(n=e[s],n){case"\\":u.expansion(1,"\\");break;case'"':u.expansion(1,'"');break;case"/":u.expansion(1,"/");break;case"b":u.expansion(1,"\b");break;case"f":u.expansion(1,"\f");break;case"n":u.expansion(1,`
`);break;case"r":u.expansion(1,"\r");break;case"t":u.expansion(1,"	");break;case"u":this._error="parse string/unicord escape not supported";break;default:break}else this._error="parse string/escape error";default:break}return this._error="parse string/illegal end",null}parseObject(e,t,i,r){if(this._error)return null;if(!e)return this._error="buffer is null",null;let s=new te,o="",n=i,u="",m=Array(1),l=!1;for(;n<t;n++){e:for(;n<t;n++)switch(u=e[n],u){case'"':if(o=this.parseString(e,t,n+1,m),this._error)return null;n=m[0],l=!0;break e;case"}":return r[0]=n+1,s;case":":this._error="illegal ':' position";break;case`
`:this._lineCount++;default:break}if(!l)return this._error="key not found",null;l=!1;e:for(;n<t;n++)switch(u=e[n],u){case":":l=!0,n++;break e;case"}":this._error="illegal '}' position";break;case`
`:this._lineCount++;default:break}if(!l)return this._error="':' not found",null;let p=this.parseValue(e,t,n,m);if(this._error)return null;n=m[0],s.put(o,p);e:for(;n<t;n++)switch(u=e[n],u){case",":break e;case"}":return r[0]=n+1,s;case`
`:this._lineCount++;default:break}}return this._error="illegal end of perseObject",null}parseArray(e,t,i,r){if(this._error)return null;if(!e)return this._error="buffer is null",null;let s=new Pe,o=i,n,u=new Array(1);for(;o<t;o++){let m=this.parseValue(e,t,o,u);if(this._error)return null;o=u[0],m&&s.add(m);e:for(;o<t;o++)switch(n=e[o],n){case",":break e;case"]":return r[0]=o+1,s;case`
`:++this._lineCount;default:break}}return s=void 0,this._error="illegal end of parseObject",null}},me=class extends O{constructor(e){super(),this._value=e}isFloat(){return!0}getString(e,t){let i="\0";return this._value=parseFloat(i),this._stringBuffer=i,this._stringBuffer}toInt(e=0){return parseInt(this._value.toString())}toFloat(e=0){return this._value}equals(e){return typeof e=="number"?Math.round(e)?!1:e==this._value:!1}},X=class extends O{isBool(){return!0}toBoolean(e=!1){return this._boolValue}getString(e,t){return this._stringBuffer=this._boolValue?"true":"false",this._stringBuffer}equals(e){return typeof e=="boolean"?e==this._boolValue:!1}isStatic(){return!0}constructor(e){super(),this._boolValue=e}},ie=class extends O{constructor(e){super(),typeof e=="string"&&(this._stringBuffer=e),e instanceof D&&(this._stringBuffer=e.s)}isString(){return!0}getString(e,t){return this._stringBuffer}equals(e){return typeof e=="string"?this._stringBuffer==e:e instanceof D?this._stringBuffer==e.s:!1}},ce=class extends ie{isStatic(){return this._isStatic}setErrorNotForClientCall(e){return this._stringBuffer=e,this}constructor(e,t){typeof e=="string"?super(e):super(e),this._isStatic=t}isError(){return!0}},ee=class extends O{isNull(){return!0}getString(e,t){return this._stringBuffer}isStatic(){return!0}setErrorNotForClientCall(e){return this._stringBuffer=e,ce.nullValue}constructor(){super(),this._stringBuffer="NullValue"}},Pe=class extends O{constructor(){super(),this._array=new _}release(){for(let e=this._array.begin();e.notEqual(this._array.end());e.preIncrement()){let t=e.ptr();t&&!t.isStatic()&&(t=void 0,t=null)}}isArray(){return!0}getValueByIndex(e){if(e<0||this._array.getSize()<=e)return O.errorValue.setErrorNotForClientCall(Kr);let t=this._array.at(e);return t??O.nullValue}getValueByString(e){return O.errorValue.setErrorNotForClientCall(At)}getString(e,t){let i=t+`[
`;for(let r=this._array.begin();r.notEqual(this._array.end());r.increment()){let s=r.ptr();this._stringBuffer+=t+""+s.getString(t+" ")+`
`}return this._stringBuffer=i+t+`]
`,this._stringBuffer}add(e){this._array.pushBack(e)}getVector(e=null){return this._array}getSize(){return this._array.getSize()}},te=class extends O{constructor(){super(),this._map=new k}release(){let e=this._map.begin();for(;e.notEqual(this._map.end());){let t=e.ptr().second;t&&!t.isStatic()&&(t=void 0,t=null),e.preIncrement()}}isMap(){return!0}getValueByString(e){if(e instanceof D){let t=this._map.getValue(e.s);return t??O.nullValue}for(let t=this._map.begin();t.notEqual(this._map.end());t.preIncrement())if(t.ptr().first==e)return t.ptr().second==null?O.nullValue:t.ptr().second;return O.nullValue}getValueByIndex(e){return O.errorValue.setErrorNotForClientCall(At)}getString(e,t){this._stringBuffer=t+`{
`;let i=this._map.begin();for(;i.notEqual(this._map.end());){let r=i.ptr().first,s=i.ptr().second;this._stringBuffer+=t+" "+r+" : "+s.getString(t+"   ")+` 
`,i.preIncrement()}return this._stringBuffer+=t+`}
`,this._stringBuffer}getMap(e){return this._map}put(e,t){this._map.setValue(e,t)}getKeys(){if(!this._keys){this._keys=new _;let e=this._map.begin();for(;e.notEqual(this._map.end());){let t=e.ptr().first;this._keys.pushBack(t),e.preIncrement()}}return this._keys}getSize(){return this._keys.getSize()}},Qr;(m=>(m.CubismJson=L,m.JsonArray=Pe,m.JsonBoolean=X,m.JsonError=ce,m.JsonFloat=me,m.JsonMap=te,m.JsonNullvalue=ee,m.JsonString=ie,m.Value=O))(Qr||={});function Di(a,e){let t=0;for(let r=1;;r++){let s=a.slice(r-1,r);if(s=="e"||s=="-"||s=="E")continue;let o=a.substring(0,r),n=Number(o);if(isNaN(n))break;t=r}let i=parseFloat(a);return isNaN(i)&&(i=NaN),e[0]=a.slice(t),i}var K=!1,Oe=!1,Ne=null,xt=null,Q=Object.freeze({vertexOffset:0,vertexStep:2});function ve(a){a&&(a=void 0)}var v=class{static startUp(e=null){if(K)return U("CubismFramework.startUp() is already done."),K;if(Ne=e,Ne!=null&&Live2DCubismCore.Logging.csmSetLogFunction(Ne.logFunction),K=!0,K){let t=Live2DCubismCore.Version.csmGetVersion(),i=(t&4278190080)>>24,r=(t&16711680)>>16,s=t&65535,o=t;U("Live2D Cubism Core version: {0}.{1}.{2} ({3})",("00"+i).slice(-2),("00"+r).slice(-2),("0000"+s).slice(-4),o)}return U("CubismFramework.startUp() is complete."),K}static cleanUp(){K=!1,Oe=!1,Ne=null,xt=null}static initialize(e=0){if(z(K),!K){W("CubismFramework is not started.");return}if(Oe){W("CubismFramework.initialize() skipped, already initialized.");return}O.staticInitializeNotForClientCall(),xt=new De,Live2DCubismCore.Memory.initializeAmountOfMemory(e),Oe=!0,U("CubismFramework.initialize() is complete.")}static dispose(){if(z(K),!K){W("CubismFramework is not started.");return}if(!Oe){W("CubismFramework.dispose() skipped, not initialized.");return}O.staticReleaseNotForClientCall(),xt.release(),xt=null,ae.staticRelease(),Oe=!1,U("CubismFramework.dispose() is complete.")}static isStarted(){return K}static isInitialized(){return Oe}static coreLogFunction(e){Live2DCubismCore.Logging.csmGetLogFunction()&&Live2DCubismCore.Logging.csmGetLogFunction()(e)}static getLoggingLevel(){return Ne!=null?Ne.loggingLevel:5}static getIdManager(){return xt}constructor(){}},Rt=class{};var es;(i=>(i.Constant=Q,i.csmDelete=ve,i.CubismFramework=v))(es||={});var Lt="auto",li=1,Oi=2,Ni=.8,ki=-1,Ui=1;var zi=-2,$i=2,Gi=-2,Hi=2,Dt="../../Resources/";var Ot=["Haru","Hiyori","Mark","Natori","Rice","Mao","Wanko"],Xi=Ot.length,Wi="Idle",Yi="TapBody";var qi=1,ji=2,mi=3,Ji=!0,ci=!0,Ki=!1,Qi=0;var F=null,f=null,ke=null,kt=class a{static getInstance(){return ke==null&&(ke=new a),ke}static releaseInstance(){ke?.release(),ke=null}constructor(){F=document.getElementById("live2d"),f=F.getContext("webgl2"),f||(alert("Cannot initialize WebGL. This browser does not support."),f=null,document.body.innerHTML="This browser does not support the <code>&lt;canvas&gt;</code> element.")}release(){}};var x=Object.freeze({HitAreaPrefix:"HitArea",HitAreaHead:"Head",HitAreaBody:"Body",PartsIdCore:"Parts01Core",PartsArmPrefix:"Parts01Arm_",PartsArmLPrefix:"Parts01ArmL_",PartsArmRPrefix:"Parts01ArmR_",ParamAngleX:"ParamAngleX",ParamAngleY:"ParamAngleY",ParamAngleZ:"ParamAngleZ",ParamEyeLOpen:"ParamEyeLOpen",ParamEyeLSmile:"ParamEyeLSmile",ParamEyeROpen:"ParamEyeROpen",ParamEyeRSmile:"ParamEyeRSmile",ParamEyeBallX:"ParamEyeBallX",ParamEyeBallY:"ParamEyeBallY",ParamEyeBallForm:"ParamEyeBallForm",ParamBrowLY:"ParamBrowLY",ParamBrowRY:"ParamBrowRY",ParamBrowLX:"ParamBrowLX",ParamBrowRX:"ParamBrowRX",ParamBrowLAngle:"ParamBrowLAngle",ParamBrowRAngle:"ParamBrowRAngle",ParamBrowLForm:"ParamBrowLForm",ParamBrowRForm:"ParamBrowRForm",ParamMouthForm:"ParamMouthForm",ParamMouthOpenY:"ParamMouthOpenY",ParamCheek:"ParamCheek",ParamBodyAngleX:"ParamBodyAngleX",ParamBodyAngleY:"ParamBodyAngleY",ParamBodyAngleZ:"ParamBodyAngleZ",ParamBreath:"ParamBreath",ParamArmLA:"ParamArmLA",ParamArmRA:"ParamArmRA",ParamArmLB:"ParamArmLB",ParamArmRB:"ParamArmRB",ParamHandL:"ParamHandL",ParamHandR:"ParamHandR",ParamHairFront:"ParamHairFront",ParamHairSide:"ParamHairSide",ParamHairBack:"ParamHairBack",ParamHairFluffy:"ParamHairFluffy",ParamShoulderY:"ParamShoulderY",ParamBustX:"ParamBustX",ParamBustY:"ParamBustY",ParamBaseX:"ParamBaseX",ParamBaseY:"ParamBaseY",ParamNONE:"NONE:"}),is;(V=>(V.HitAreaBody=x.HitAreaBody,V.HitAreaHead=x.HitAreaHead,V.HitAreaPrefix=x.HitAreaPrefix,V.ParamAngleX=x.ParamAngleX,V.ParamAngleY=x.ParamAngleY,V.ParamAngleZ=x.ParamAngleZ,V.ParamArmLA=x.ParamArmLA,V.ParamArmLB=x.ParamArmLB,V.ParamArmRA=x.ParamArmRA,V.ParamArmRB=x.ParamArmRB,V.ParamBaseX=x.ParamBaseX,V.ParamBaseY=x.ParamBaseY,V.ParamBodyAngleX=x.ParamBodyAngleX,V.ParamBodyAngleY=x.ParamBodyAngleY,V.ParamBodyAngleZ=x.ParamBodyAngleZ,V.ParamBreath=x.ParamBreath,V.ParamBrowLAngle=x.ParamBrowLAngle,V.ParamBrowLForm=x.ParamBrowLForm,V.ParamBrowLX=x.ParamBrowLX,V.ParamBrowLY=x.ParamBrowLY,V.ParamBrowRAngle=x.ParamBrowRAngle,V.ParamBrowRForm=x.ParamBrowRForm,V.ParamBrowRX=x.ParamBrowRX,V.ParamBrowRY=x.ParamBrowRY,V.ParamBustX=x.ParamBustX,V.ParamBustY=x.ParamBustY,V.ParamCheek=x.ParamCheek,V.ParamEyeBallForm=x.ParamEyeBallForm,V.ParamEyeBallX=x.ParamEyeBallX,V.ParamEyeBallY=x.ParamEyeBallY,V.ParamEyeLOpen=x.ParamEyeLOpen,V.ParamEyeLSmile=x.ParamEyeLSmile,V.ParamEyeROpen=x.ParamEyeROpen,V.ParamEyeRSmile=x.ParamEyeRSmile,V.ParamHairBack=x.ParamHairBack,V.ParamHairFluffy=x.ParamHairFluffy,V.ParamHairFront=x.ParamHairFront,V.ParamHairSide=x.ParamHairSide,V.ParamHandL=x.ParamHandL,V.ParamHandR=x.ParamHandR,V.ParamMouthForm=x.ParamMouthForm,V.ParamMouthOpenY=x.ParamMouthOpenY,V.ParamNONE=x.ParamNONE,V.ParamShoulderY=x.ParamShoulderY,V.PartsArmLPrefix=x.PartsArmLPrefix,V.PartsArmPrefix=x.PartsArmPrefix,V.PartsArmRPrefix=x.PartsArmRPrefix,V.PartsIdCore=x.PartsIdCore))(is||={});var Ue=class{},ss;(e=>e.ICubismModelSetting=Ue)(ss||={});var he="FileReferences",ns="Groups",os="Layout",us="HitAreas",ls="Moc",ms="Textures",cs="Physics",hs="Pose",ps="Expressions",gs="Motions",Zi="UserData",pe="Name",er="File",ds="Id",Ut="Ids";var tr="Sound",ir="FadeInTime",rr="FadeOutTime";var hi="LipSync",pi="EyeBlink";var ze=class extends Ue{constructor(e,t){super(),this._json=L.create(e,t),this.getJson()&&(this._jsonValue=new _,this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(ns)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(he).getValueByString(ls)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(he).getValueByString(gs)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(he).getValueByString(ps)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(he).getValueByString(ms)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(he).getValueByString(cs)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(he).getValueByString(hs)),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(us)))}release(){L.delete(this._json),this._jsonValue=null}getJson(){return this._json}getModelFileName(){return this.isExistModelFile()?this._jsonValue.at(1).getRawString():""}getTextureCount(){return this.isExistTextureFiles()?this._jsonValue.at(4).getSize():0}getTextureDirectory(){let t=this._jsonValue.at(4).getValueByIndex(0).getRawString().split("/"),i=t.length-1,r="";for(let s=0;s<i;s++)r+=t[s],s<i-1&&(r+="/");return r}getTextureFileName(e){return this._jsonValue.at(4).getValueByIndex(e).getRawString()}getHitAreasCount(){return this.isExistHitAreas()?this._jsonValue.at(7).getSize():0}getHitAreaId(e){return v.getIdManager().getId(this._jsonValue.at(7).getValueByIndex(e).getValueByString(ds).getRawString())}getHitAreaName(e){return this._jsonValue.at(7).getValueByIndex(e).getValueByString(pe).getRawString()}getPhysicsFileName(){return this.isExistPhysicsFile()?this._jsonValue.at(5).getRawString():""}getPoseFileName(){return this.isExistPoseFile()?this._jsonValue.at(6).getRawString():""}getExpressionCount(){return this.isExistExpressionFile()?this._jsonValue.at(3).getSize():0}getExpressionName(e){return this._jsonValue.at(3).getValueByIndex(e).getValueByString(pe).getRawString()}getExpressionFileName(e){return this._jsonValue.at(3).getValueByIndex(e).getValueByString(er).getRawString()}getMotionGroupCount(){return this.isExistMotionGroups()?this._jsonValue.at(2).getKeys().getSize():0}getMotionGroupName(e){return this.isExistMotionGroups()?this._jsonValue.at(2).getKeys().at(e):null}getMotionCount(e){return this.isExistMotionGroupName(e)?this._jsonValue.at(2).getValueByString(e).getSize():0}getMotionFileName(e,t){return this.isExistMotionGroupName(e)?this._jsonValue.at(2).getValueByString(e).getValueByIndex(t).getValueByString(er).getRawString():""}getMotionSoundFileName(e,t){return this.isExistMotionSoundFile(e,t)?this._jsonValue.at(2).getValueByString(e).getValueByIndex(t).getValueByString(tr).getRawString():""}getMotionFadeInTimeValue(e,t){return this.isExistMotionFadeIn(e,t)?this._jsonValue.at(2).getValueByString(e).getValueByIndex(t).getValueByString(ir).toFloat():-1}getMotionFadeOutTimeValue(e,t){return this.isExistMotionFadeOut(e,t)?this._jsonValue.at(2).getValueByString(e).getValueByIndex(t).getValueByString(rr).toFloat():-1}getUserDataFile(){return this.isExistUserDataFile()?this.getJson().getRoot().getValueByString(he).getValueByString(Zi).getRawString():""}getLayoutMap(e){let t=this.getJson().getRoot().getValueByString(os).getMap();if(t==null)return!1;let i=!1;for(let r=t.begin();r.notEqual(t.end());r.preIncrement())e.setValue(r.ptr().first,r.ptr().second.toFloat()),i=!0;return i}getEyeBlinkParameterCount(){if(!this.isExistEyeBlinkParameters())return 0;let e=0;for(let t=0;t<this._jsonValue.at(0).getSize();t++){let i=this._jsonValue.at(0).getValueByIndex(t);if(!(i.isNull()||i.isError())&&i.getValueByString(pe).getRawString()==pi){e=i.getValueByString(Ut).getVector().getSize();break}}return e}getEyeBlinkParameterId(e){if(!this.isExistEyeBlinkParameters())return null;for(let t=0;t<this._jsonValue.at(0).getSize();t++){let i=this._jsonValue.at(0).getValueByIndex(t);if(!(i.isNull()||i.isError())&&i.getValueByString(pe).getRawString()==pi)return v.getIdManager().getId(i.getValueByString(Ut).getValueByIndex(e).getRawString())}return null}getLipSyncParameterCount(){if(!this.isExistLipSyncParameters())return 0;let e=0;for(let t=0;t<this._jsonValue.at(0).getSize();t++){let i=this._jsonValue.at(0).getValueByIndex(t);if(!(i.isNull()||i.isError())&&i.getValueByString(pe).getRawString()==hi){e=i.getValueByString(Ut).getVector().getSize();break}}return e}getLipSyncParameterId(e){if(!this.isExistLipSyncParameters())return null;for(let t=0;t<this._jsonValue.at(0).getSize();t++){let i=this._jsonValue.at(0).getValueByIndex(t);if(!(i.isNull()||i.isError())&&i.getValueByString(pe).getRawString()==hi)return v.getIdManager().getId(i.getValueByString(Ut).getValueByIndex(e).getRawString())}return null}isExistModelFile(){let e=this._jsonValue.at(1);return!e.isNull()&&!e.isError()}isExistTextureFiles(){let e=this._jsonValue.at(4);return!e.isNull()&&!e.isError()}isExistHitAreas(){let e=this._jsonValue.at(7);return!e.isNull()&&!e.isError()}isExistPhysicsFile(){let e=this._jsonValue.at(5);return!e.isNull()&&!e.isError()}isExistPoseFile(){let e=this._jsonValue.at(6);return!e.isNull()&&!e.isError()}isExistExpressionFile(){let e=this._jsonValue.at(3);return!e.isNull()&&!e.isError()}isExistMotionGroups(){let e=this._jsonValue.at(2);return!e.isNull()&&!e.isError()}isExistMotionGroupName(e){let t=this._jsonValue.at(2).getValueByString(e);return!t.isNull()&&!t.isError()}isExistMotionSoundFile(e,t){let i=this._jsonValue.at(2).getValueByString(e).getValueByIndex(t).getValueByString(tr);return!i.isNull()&&!i.isError()}isExistMotionFadeIn(e,t){let i=this._jsonValue.at(2).getValueByString(e).getValueByIndex(t).getValueByString(ir);return!i.isNull()&&!i.isError()}isExistMotionFadeOut(e,t){let i=this._jsonValue.at(2).getValueByString(e).getValueByIndex(t).getValueByString(rr);return!i.isNull()&&!i.isError()}isExistUserDataFile(){let e=this.getJson().getRoot().getValueByString(he).getValueByString(Zi);return!e.isNull()&&!e.isError()}isExistEyeBlinkParameters(){if(this._jsonValue.at(0).isNull()||this._jsonValue.at(0).isError())return!1;for(let e=0;e<this._jsonValue.at(0).getSize();++e)if(this._jsonValue.at(0).getValueByIndex(e).getValueByString(pe).getRawString()==pi)return!0;return!1}isExistLipSyncParameters(){if(this._jsonValue.at(0).isNull()||this._jsonValue.at(0).isError())return!1;for(let e=0;e<this._jsonValue.at(0).getSize();++e)if(this._jsonValue.at(0).getValueByIndex(e).getValueByString(pe).getRawString()==hi)return!0;return!1}},bs;(e=>e.CubismModelSettingJson=ze)(bs||={});var ge=class a{static create(){return new a}static delete(e){e!=null&&(e=null)}setParameters(e){this._breathParameters=e}getParameters(){return this._breathParameters}updateParameters(e,t){this._currentTime+=t;let i=this._currentTime*2*3.14159;for(let r=0;r<this._breathParameters.getSize();++r){let s=this._breathParameters.at(r);e.addParameterValueById(s.parameterId,s.offset+s.peak*Math.sin(i/s.cycle),s.weight)}}constructor(){this._currentTime=0}},re=class{constructor(e,t,i,r,s){this.parameterId=e??null,this.offset=t??0,this.peak=i??0,this.cycle=r??0,this.weight=s??0}},fs;(t=>(t.BreathParameterData=re,t.CubismBreath=ge))(fs||={});var de=class a{static create(e=null){return new a(e)}static delete(e){e!=null&&(e=null)}setBlinkingInterval(e){this._blinkingIntervalSeconds=e}setBlinkingSetting(e,t,i){this._closingSeconds=e,this._closedSeconds=t,this._openingSeconds=i}setParameterIds(e){this._parameterIds=e}getParameterIds(){return this._parameterIds}updateParameters(e,t){this._userTimeSeconds+=t;let i,r=0;switch(this._blinkingState){case 2:r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds,r>=1&&(r=1,this._blinkingState=3,this._stateStartTimeSeconds=this._userTimeSeconds),i=1-r;break;case 3:r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds,r>=1&&(this._blinkingState=4,this._stateStartTimeSeconds=this._userTimeSeconds),i=0;break;case 4:r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds,r>=1&&(r=1,this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming()),i=r;break;case 1:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=2,this._stateStartTimeSeconds=this._userTimeSeconds),i=1;break;case 0:default:this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming(),i=1;break}a.CloseIfZero||(i=-i);for(let o=0;o<this._parameterIds.getSize();++o)e.setParameterValueById(this._parameterIds.at(o),i)}constructor(e){if(this._blinkingState=0,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=new _,e!=null)for(let t=0;t<e.getEyeBlinkParameterCount();++t)this._parameterIds.pushBack(e.getEyeBlinkParameterId(t))}determinNextBlinkingTiming(){let e=Math.random();return this._userTimeSeconds+e*(2*this._blinkingIntervalSeconds-1)}static{this.CloseIfZero=!0}},gi=(s=>(s[s.EyeState_First=0]="EyeState_First",s[s.EyeState_Interval=1]="EyeState_Interval",s[s.EyeState_Closing=2]="EyeState_Closing",s[s.EyeState_Closed=3]="EyeState_Closed",s[s.EyeState_Opening=4]="EyeState_Opening",s))(gi||{}),ys;(t=>(t.CubismEyeBlink=de,t.EyeState=gi))(ys||={});var Ms=.001,di=.5,sr="FadeInTime",ar="Link",Ss="Groups",Ps="Id",Ve=class a{static create(e,t){let i=L.create(e,t);if(!i)return null;let r=new a,s=i.getRoot();s.getValueByString(sr).isNull()||(r._fadeTimeSeconds=s.getValueByString(sr).toFloat(di),r._fadeTimeSeconds<=0&&(r._fadeTimeSeconds=di));let o=s.getValueByString(Ss),n=o.getSize();for(let u=0;u<n;++u){let m=o.getValueByIndex(u),l=m.getSize(),p=0;for(let d=0;d<l;++d){let c=m.getValueByIndex(d),h=new $e,b=v.getIdManager().getId(c.getValueByString(Ps).getRawString());if(h.partId=b,!c.getValueByString(ar).isNull()){let g=c.getValueByString(ar),y=g.getSize();for(let T=0;T<y;++T){let C=new $e,P=v.getIdManager().getId(g.getValueByIndex(T).getString());C.partId=P,h.link.pushBack(C)}}r._partGroups.pushBack(h.clone()),++p}r._partGroupCounts.pushBack(p)}return L.delete(i),r}static delete(e){e!=null&&(e=null)}updateParameters(e,t){e!=this._lastModel&&this.reset(e),this._lastModel=e,t<0&&(t=0);let i=0;for(let r=0;r<this._partGroupCounts.getSize();r++){let s=this._partGroupCounts.at(r);this.doFade(e,t,i,s),i+=s}this.copyPartOpacities(e)}reset(e){let t=0;for(let i=0;i<this._partGroupCounts.getSize();++i){let r=this._partGroupCounts.at(i);for(let s=t;s<t+r;++s){this._partGroups.at(s).initialize(e);let o=this._partGroups.at(s).partIndex,n=this._partGroups.at(s).parameterIndex;if(!(o<0)){e.setPartOpacityByIndex(o,s==t?1:0),e.setParameterValueByIndex(n,s==t?1:0);for(let u=0;u<this._partGroups.at(s).link.getSize();++u)this._partGroups.at(s).link.at(u).initialize(e)}}t+=r}}copyPartOpacities(e){for(let t=0;t<this._partGroups.getSize();++t){let i=this._partGroups.at(t);if(i.link.getSize()==0)continue;let r=this._partGroups.at(t).partIndex,s=e.getPartOpacityByIndex(r);for(let o=0;o<i.link.getSize();++o){let u=i.link.at(o).partIndex;u<0||e.setPartOpacityByIndex(u,s)}}}doFade(e,t,i,r){let s=-1,o=1,n=.5,u=.15;for(let m=i;m<i+r;++m){let l=this._partGroups.at(m).partIndex,p=this._partGroups.at(m).parameterIndex;if(e.getParameterValueByIndex(p)>Ms){if(s>=0)break;s=m,o=e.getPartOpacityByIndex(l),o+=t/this._fadeTimeSeconds,o>1&&(o=1)}}s<0&&(s=0,o=1);for(let m=i;m<i+r;++m){let l=this._partGroups.at(m).partIndex;if(s==m)e.setPartOpacityByIndex(l,o);else{let p=e.getPartOpacityByIndex(l),d;o<n?d=o*(n-1)/n+1:d=(1-o)*n/(1-n),(1-d)*(1-o)>u&&(d=1-u/(1-o)),p>d&&(p=d),e.setPartOpacityByIndex(l,p)}}}constructor(){this._fadeTimeSeconds=di,this._lastModel=null,this._partGroups=new _,this._partGroupCounts=new _}},$e=class a{constructor(e){if(this.parameterIndex=0,this.partIndex=0,this.link=new _,e!=null){this.partId=e.partId;for(let t=e.link.begin();t.notEqual(e.link.end());t.preIncrement())this.link.pushBack(t.ptr().clone())}}assignment(e){this.partId=e.partId;for(let t=e.link.begin();t.notEqual(e.link.end());t.preIncrement())this.link.pushBack(t.ptr().clone());return this}initialize(e){this.parameterIndex=e.getParameterIndex(this.partId),this.partIndex=e.getPartIndex(this.partId),e.setParameterValueByIndex(this.parameterIndex,1)}clone(){let e=new a;e.partId=this.partId,e.parameterIndex=this.parameterIndex,e.partIndex=this.partIndex,e.link=new _;for(let t=this.link.begin();t.notEqual(this.link.end());t.increment())e.link.pushBack(t.ptr().clone());return e}},vs;(t=>(t.CubismPose=Ve,t.PartData=$e))(vs||={});var Ge=class extends A{constructor(e,t){super(),this._width=e!==void 0?e:0,this._height=t!==void 0?t:0,this.setHeight(2)}setWidth(e){let t=e/this._width,i=t;this.scale(t,i)}setHeight(e){let t=e/this._height,i=t;this.scale(t,i)}setPosition(e,t){this.translate(e,t)}setCenterPosition(e,t){this.centerX(e),this.centerY(t)}top(e){this.setY(e)}bottom(e){let t=this._height*this.getScaleY();this.translateY(e-t)}left(e){this.setX(e)}right(e){let t=this._width*this.getScaleX();this.translateX(e-t)}centerX(e){let t=this._width*this.getScaleX();this.translateX(e-t/2)}setX(e){this.translateX(e)}centerY(e){let t=this._height*this.getScaleY();this.translateY(e-t/2)}setY(e){this.translateY(e)}setupFromLayout(e){let t="width",i="height",r="x",s="y",o="center_x",n="center_y",u="top",m="bottom",l="left",p="right";for(let d=e.begin();d.notEqual(e.end());d.preIncrement()){let c=d.ptr().first,h=d.ptr().second;c==t?this.setWidth(h):c==i&&this.setHeight(h)}for(let d=e.begin();d.notEqual(e.end());d.preIncrement()){let c=d.ptr().first,h=d.ptr().second;c==r?this.setX(h):c==s?this.setY(h):c==o?this.centerX(h):c==n?this.centerY(h):c==u?this.top(h):c==m?this.bottom(h):c==l?this.left(h):c==p&&this.right(h)}}},Is;(e=>e.CubismModelMatrix=Ge)(Is||={});var M=class a{constructor(e,t){this.x=e;this.y=t;this.x=e??0,this.y=t??0}add(e){let t=new a(0,0);return t.x=this.x+e.x,t.y=this.y+e.y,t}substract(e){let t=new a(0,0);return t.x=this.x-e.x,t.y=this.y-e.y,t}multiply(e){let t=new a(0,0);return t.x=this.x*e.x,t.y=this.y*e.y,t}multiplyByScaler(e){return this.multiply(new a(e,e))}division(e){let t=new a(0,0);return t.x=this.x/e.x,t.y=this.y/e.y,t}divisionByScalar(e){return this.division(new a(e,e))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(e){return Math.sqrt((this.x-e.x)*(this.x-e.x)+(this.y-e.y)*(this.y-e.y))}dot(e){return this.x*e.x+this.y*e.y}normalize(){let e=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/e,this.y=this.y/e}isEqual(e){return this.x==e.x&&this.y==e.y}isNotEqual(e){return!this.isEqual(e)}},Ts;(e=>e.CubismVector2=M)(Ts||={});var S=class a{static{this.Epsilon=1e-5}static range(e,t,i){return e<t?e=t:e>i&&(e=i),e}static sin(e){return Math.sin(e)}static cos(e){return Math.cos(e)}static abs(e){return Math.abs(e)}static sqrt(e){return Math.sqrt(e)}static cbrt(e){if(e===0)return e;let t=e,i=t<0;i&&(t=-t);let r;return t===1/0?r=1/0:(r=Math.exp(Math.log(t)/3),r=(t/(r*r)+2*r)/3),i?-r:r}static getEasingSine(e){return e<0?0:e>1?1:.5-.5*this.cos(e*Math.PI)}static max(e,t){return e>t?e:t}static min(e,t){return e>t?t:e}static degreesToRadian(e){return e/180*Math.PI}static radianToDegrees(e){return e*180/Math.PI}static directionToRadian(e,t){let i=Math.atan2(t.y,t.x),r=Math.atan2(e.y,e.x),s=i-r;for(;s<-Math.PI;)s+=Math.PI*2;for(;s>Math.PI;)s-=Math.PI*2;return s}static directionToDegrees(e,t){let i=this.directionToRadian(e,t),r=this.radianToDegrees(i);return t.x-e.x>0&&(r=-r),r}static radianToDirection(e){let t=new M;return t.x=this.sin(e),t.y=this.cos(e),t}static quadraticEquation(e,t,i){return this.abs(e)<a.Epsilon?this.abs(t)<a.Epsilon?-i:-i/t:-(t+this.sqrt(t*t-4*e*i))/(2*e)}static cardanoAlgorithmForBezier(e,t,i,r){if(this.sqrt(e)<a.Epsilon)return this.range(this.quadraticEquation(t,i,r),0,1);let s=t/e,o=i/e,n=r/e,u=(3*o-s*s)/3,m=u/3,l=(2*s*s*s-9*s*o+27*n)/27,p=l/2,d=p*p+m*m*m,c=.5,h=c+.01;if(d<0){let C=-u/3,P=C*C*C,I=this.sqrt(P),$=-l/(2*I),G=this.range($,-1,1),Ce=Math.acos(G),ye=2*this.cbrt(I),oi=ye*this.cos(Ce/3)-s/3;if(this.abs(oi-c)<h)return this.range(oi,0,1);let ui=ye*this.cos((Ce+2*Math.PI)/3)-s/3;if(this.abs(ui-c)<h)return this.range(ui,0,1);let Ri=ye*this.cos((Ce+4*Math.PI)/3)-s/3;return this.range(Ri,0,1)}if(d==0){let C;p<0?C=this.cbrt(-p):C=-this.cbrt(p);let P=2*C-s/3;if(this.abs(P-c)<h)return this.range(P,0,1);let I=-C-s/3;return this.range(I,0,1)}let b=this.sqrt(d),g=this.cbrt(b-p),y=this.cbrt(b+p),T=g-y-s/3;return this.range(T,0,1)}static mod(e,t){if(!isFinite(e)||t===0||isNaN(e)||isNaN(t))return console.warn(`divided: ${e}, divisor: ${t} mod() returns 'NaN'.`),NaN;let i=Math.abs(e),r=Math.abs(t),s=i-Math.floor(i/r)*r;return s*=Math.sign(e),s}constructor(){}},ws;(e=>e.CubismMath=S)(ws||={});var bi=30,nr=.01,He=class{constructor(){this._faceTargetX=0,this._faceTargetY=0,this._faceX=0,this._faceY=0,this._faceVX=0,this._faceVY=0,this._lastTimeSeconds=0,this._userTimeSeconds=0}update(e){this._userTimeSeconds+=e;let i=40/10*1/bi;if(this._lastTimeSeconds==0){this._lastTimeSeconds=this._userTimeSeconds;return}let r=(this._userTimeSeconds-this._lastTimeSeconds)*bi;this._lastTimeSeconds=this._userTimeSeconds;let o=.15*bi,n=r*i/o,u=this._faceTargetX-this._faceX,m=this._faceTargetY-this._faceY;if(S.abs(u)<=nr&&S.abs(m)<=nr)return;let l=S.sqrt(u*u+m*m),p=i*u/l,d=i*m/l,c=p-this._faceVX,h=d-this._faceVY,b=S.sqrt(c*c+h*h);(b<-n||b>n)&&(c*=n/b,h*=n/b),this._faceVX+=c,this._faceVY+=h;{let g=.5*(S.sqrt(n*n+16*n*l-8*n*l)-n),y=S.sqrt(this._faceVX*this._faceVX+this._faceVY*this._faceVY);y>g&&(this._faceVX*=g/y,this._faceVY*=g/y)}this._faceX+=this._faceVX,this._faceY+=this._faceVY}getX(){return this._faceX}getY(){return this._faceY}set(e,t){this._faceTargetX=e,this._faceTargetY=t}},As;(e=>e.CubismTargetPoint=He)(As||={});var Y=class{constructor(){this.setFinishedMotionHandler=e=>this._onFinishedMotion=e;this.getFinishedMotionHandler=()=>this._onFinishedMotion;this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._firedEventValues=new _}static delete(e){e.release(),e=null}release(){this._weight=0}updateParameters(e,t,i){if(!t.isAvailable()||t.isFinished())return;this.setupMotionQueueEntry(t,i);let r=this.updateFadeWeight(t,i);this.doUpdateParameters(e,i,r,t),t.getEndTime()>0&&t.getEndTime()<i&&t.setIsFinished(!0)}setupMotionQueueEntry(e,t){if(e==null||e.isStarted()||!e.isAvailable())return;e.setIsStarted(!0),e.setStartTime(t-this._offsetSeconds),e.setFadeInStartTime(t);let i=this.getDuration();e.getEndTime()<0&&e.setEndTime(i<=0?-1:e.getStartTime()+i)}updateFadeWeight(e,t){e==null&&Me.print(4,"motionQueueEntry is null.");let i=this._weight,r=this._fadeInSeconds==0?1:S.getEasingSine((t-e.getFadeInStartTime())/this._fadeInSeconds),s=this._fadeOutSeconds==0||e.getEndTime()<0?1:S.getEasingSine((e.getEndTime()-t)/this._fadeOutSeconds);return i=i*r*s,e.setState(t,i),z(0<=i&&i<=1),i}setFadeInTime(e){this._fadeInSeconds=e}setFadeOutTime(e){this._fadeOutSeconds=e}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(e){this._weight=e}getWeight(){return this._weight}getDuration(){return-1}getLoopDuration(){return-1}setOffsetTime(e){this._offsetSeconds=e}getFiredEvent(e,t){return this._firedEventValues}isExistModelOpacity(){return!1}getModelOpacityIndex(){return-1}getModelOpacityId(e){return null}getModelOpacityValue(){return 1}},Ls;(e=>e.ACubismMotion=Y)(Ls||={});var Os="FadeInTime",Ns="FadeOutTime",or="Parameters",ks="Id",Us="Value",zt="Blend",zs="Add",$s="Multiply",Gs="Overwrite",ur=1,Z=class a extends Y{static{this.DefaultAdditiveValue=0}static{this.DefaultMultiplyValue=1}static create(e,t){let i=new a;return i.parse(e,t),i}doUpdateParameters(e,t,i,r){for(let s=0;s<this._parameters.getSize();++s){let o=this._parameters.at(s);switch(o.blendType){case 0:{e.addParameterValueById(o.parameterId,o.value,i);break}case 1:{e.multiplyParameterValueById(o.parameterId,o.value,i);break}case 2:{e.setParameterValueById(o.parameterId,o.value,i);break}default:break}}}calculateExpressionParameters(e,t,i,r,s,o){if(!(i==null||r==null)&&i.isAvailable()){this._fadeWeight=this.updateFadeWeight(i,t);for(let n=0;n<r.getSize();++n){let u=r.at(n);if(u.parameterId==null)continue;let m=u.overwriteValue=e.getParameterValueById(u.parameterId),l=this.getExpressionParameters(),p=-1;for(let g=0;g<l.getSize();++g)if(u.parameterId==l.at(g).parameterId){p=g;break}if(p<0){s==0?(u.additiveValue=a.DefaultAdditiveValue,u.multiplyValue=a.DefaultMultiplyValue,u.overwriteValue=m):(u.additiveValue=this.calculateValue(u.additiveValue,a.DefaultAdditiveValue,o),u.multiplyValue=this.calculateValue(u.multiplyValue,a.DefaultMultiplyValue,o),u.overwriteValue=this.calculateValue(u.overwriteValue,m,o));continue}let d=l.at(p).value,c,h,b;switch(l.at(p).blendType){case 0:c=d,h=a.DefaultMultiplyValue,b=m;break;case 1:c=a.DefaultAdditiveValue,h=d,b=m;break;case 2:c=a.DefaultAdditiveValue,h=a.DefaultMultiplyValue,b=d;break;default:return}s==0?(u.additiveValue=c,u.multiplyValue=h,u.overwriteValue=b):(u.additiveValue=u.additiveValue*(1-o)+c*o,u.multiplyValue=u.multiplyValue*(1-o)+h*o,u.overwriteValue=u.overwriteValue*(1-o)+b*o)}}}getExpressionParameters(){return this._parameters}getFadeWeight(){return this._fadeWeight}parse(e,t){let i=L.create(e,t);if(!i)return;let r=i.getRoot();this.setFadeInTime(r.getValueByString(Os).toFloat(ur)),this.setFadeOutTime(r.getValueByString(Ns).toFloat(ur));let s=r.getValueByString(or).getSize();this._parameters.prepareCapacity(s);for(let o=0;o<s;++o){let n=r.getValueByString(or).getValueByIndex(o),u=v.getIdManager().getId(n.getValueByString(ks).getRawString()),m=n.getValueByString(Us).toFloat(),l;n.getValueByString(zt).isNull()||n.getValueByString(zt).getString()==zs?l=0:n.getValueByString(zt).getString()==$s?l=1:n.getValueByString(zt).getString()==Gs?l=2:l=0;let p=new Mt;p.parameterId=u,p.blendType=l,p.value=m,this._parameters.pushBack(p)}L.delete(i)}calculateValue(e,t,i){return e*(1-i)+t*i}constructor(){super(),this._parameters=new _,this._fadeWeight=0}},_i=(i=>(i[i.Additive=0]="Additive",i[i.Multiply=1]="Multiply",i[i.Overwrite=2]="Overwrite",i))(_i||{}),Mt=class{},Hs;(i=>(i.CubismExpressionMotion=Z,i.ExpressionBlendType=_i,i.ExpressionParameter=Mt))(Hs||={});var Xe=class{constructor(){this._autoDelete=!1,this._motion=null,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this,this._fadeOutSeconds=0,this._isTriggeredFadeOut=!1}release(){this._autoDelete&&this._motion&&Y.delete(this._motion)}setFadeOut(e){this._fadeOutSeconds=e,this._isTriggeredFadeOut=!0}startFadeOut(e,t){let i=t+e;this._isTriggeredFadeOut=!0,(this._endTimeSeconds<0||i<this._endTimeSeconds)&&(this._endTimeSeconds=i)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(e){this._startTimeSeconds=e}setFadeInStartTime(e){this._fadeInStartTimeSeconds=e}setEndTime(e){this._endTimeSeconds=e}setIsFinished(e){this._finished=e}setIsStarted(e){this._started=e}isAvailable(){return this._available}setIsAvailable(e){this._available=e}setState(e,t){this._stateTimeSeconds=e,this._stateWeight=t}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventSeconds(){return this._lastEventCheckSeconds}setLastCheckEventSeconds(e){this._lastEventCheckSeconds=e}isTriggeredFadeOut(){return this._isTriggeredFadeOut}getFadeOutSeconds(){return this._fadeOutSeconds}getCubismMotion(){return this._motion}},Ws;(e=>e.CubismMotionQueueEntry=Xe)(Ws||={});var be=class{constructor(){this._userTimeSeconds=0,this._eventCallBack=null,this._eventCustomData=null,this._motions=new _}release(){for(let e=0;e<this._motions.getSize();++e)this._motions.at(e)&&(this._motions.at(e).release(),this._motions.set(e,null));this._motions=null}startMotion(e,t,i){if(e==null)return We;let r=null;for(let s=0;s<this._motions.getSize();++s)r=this._motions.at(s),r?.setFadeOut(r._motion.getFadeOutTime());return r=new Xe,r._autoDelete=t,r._motion=e,this._motions.pushBack(r),r._motionQueueEntryHandle}isFinished(){for(let e=this._motions.begin();e.notEqual(this._motions.end());){let t=e.ptr();if(t==null){e=this._motions.erase(e);continue}if(t._motion==null){t.release(),t=null,e=this._motions.erase(e);continue}if(t.isFinished())e.preIncrement();else return!1}return!0}isFinishedByHandle(e){for(let t=this._motions.begin();t.notEqual(this._motions.end());t.increment()){let i=t.ptr();if(i!=null&&i._motionQueueEntryHandle==e&&!i.isFinished())return!1}return!0}stopAllMotions(){for(let e=this._motions.begin();e.notEqual(this._motions.end());){let t=e.ptr();if(t==null){e=this._motions.erase(e);continue}t.release(),t=null,e=this._motions.erase(e)}}getCubismMotionQueueEntries(){return this._motions}getCubismMotionQueueEntry(e){for(let t=this._motions.begin();t.notEqual(this._motions.end());t.preIncrement()){let i=t.ptr();if(i!=null&&i._motionQueueEntryHandle==e)return i}return null}setEventCallback(e,t=null){this._eventCallBack=e,this._eventCustomData=t}doUpdateMotion(e,t){let i=!1;for(let r=this._motions.begin();r.notEqual(this._motions.end());){let s=r.ptr();if(s==null){r=this._motions.erase(r);continue}let o=s._motion;if(o==null){s.release(),s=null,r=this._motions.erase(r);continue}o.updateParameters(e,s,t),i=!0;let n=o.getFiredEvent(s.getLastCheckEventSeconds()-s.getStartTime(),t-s.getStartTime());for(let u=0;u<n.getSize();++u)this._eventCallBack(this,n.at(u),this._eventCustomData);s.setLastCheckEventSeconds(t),s.isFinished()?(s.release(),s=null,r=this._motions.erase(r)):(s.isTriggeredFadeOut()&&s.startFadeOut(s.getFadeOutSeconds(),t),r.preIncrement())}return i}},We=-1,qs;(t=>(t.CubismMotionQueueManager=be,t.InvalidMotionQueueEntryHandleValue=We))(qs||={});var fi=class{},Ye=class extends be{constructor(){super(),this._currentPriority=0,this._reservePriority=0,this._expressionParameterValues=new _,this._fadeWeights=new _}release(){this._expressionParameterValues&&(ve(this._expressionParameterValues),this._expressionParameterValues=null),this._fadeWeights&&(ve(this._fadeWeights),this._fadeWeights=null)}getCurrentPriority(){return this._currentPriority}getReservePriority(){return this._reservePriority}getFadeWeight(e){return this._fadeWeights.at(e)}setReservePriority(e){this._reservePriority=e}startMotionPriority(e,t,i){return i==this.getReservePriority()&&this.setReservePriority(0),this._currentPriority=i,this._fadeWeights.pushBack(0),this.startMotion(e,t)}updateMotion(e,t){this._userTimeSeconds+=t;let i=!1,r=this.getCubismMotionQueueEntries(),s=0,o=0;for(let n=this._motions.begin();n.notEqual(this._motions.end());){let u=n.ptr();if(u==null){n=r.erase(n);continue}let m=u.getCubismMotion();if(m==null){ve(u),n=r.erase(n);continue}let l=m.getExpressionParameters();if(u.isAvailable())for(let p=0;p<l.getSize();++p){if(l.at(p).parameterId==null)continue;let d=-1;for(let h=0;h<this._expressionParameterValues.getSize();++h)if(this._expressionParameterValues.at(h).parameterId==l.at(p).parameterId){d=h;break}if(d>=0)continue;let c=new fi;c.parameterId=l.at(p).parameterId,c.additiveValue=Z.DefaultAdditiveValue,c.multiplyValue=Z.DefaultMultiplyValue,c.overwriteValue=e.getParameterValueById(c.parameterId),this._expressionParameterValues.pushBack(c)}m.setupMotionQueueEntry(u,this._userTimeSeconds),this._fadeWeights.set(o,m.updateFadeWeight(u,this._userTimeSeconds)),m.calculateExpressionParameters(e,this._userTimeSeconds,u,this._expressionParameterValues,o,this._fadeWeights.at(o)),s+=m.getFadeInTime()==0?1:S.getEasingSine((this._userTimeSeconds-u.getFadeInStartTime())/m.getFadeInTime()),i=!0,u.isTriggeredFadeOut()&&u.startFadeOut(u.getFadeOutSeconds(),this._userTimeSeconds),n.preIncrement(),++o}if(r.getSize()>1){let n=r.at(r.getSize()-1).getCubismMotion();if(this._fadeWeights.at(this._fadeWeights.getSize()-1)>=1)for(let m=r.getSize()-2;m>=0;--m){let l=r.at(m);ve(l),r.remove(m),this._fadeWeights.remove(m)}}s>1&&(s=1);for(let n=0;n<this._expressionParameterValues.getSize();++n){let u=this._expressionParameterValues.at(n);e.setParameterValueById(u.parameterId,(u.overwriteValue+u.additiveValue)*u.multiplyValue,s),u.additiveValue=Z.DefaultAdditiveValue,u.multiplyValue=Z.DefaultMultiplyValue}return i}},Js;(e=>e.CubismExpressionMotionManager=Ye)(Js||={});var $t=(i=>(i[i.CubismMotionCurveTarget_Model=0]="CubismMotionCurveTarget_Model",i[i.CubismMotionCurveTarget_Parameter=1]="CubismMotionCurveTarget_Parameter",i[i.CubismMotionCurveTarget_PartOpacity=2]="CubismMotionCurveTarget_PartOpacity",i))($t||{}),Gt=(r=>(r[r.CubismMotionSegmentType_Linear=0]="CubismMotionSegmentType_Linear",r[r.CubismMotionSegmentType_Bezier=1]="CubismMotionSegmentType_Bezier",r[r.CubismMotionSegmentType_Stepped=2]="CubismMotionSegmentType_Stepped",r[r.CubismMotionSegmentType_InverseStepped=3]="CubismMotionSegmentType_InverseStepped",r))(Gt||{}),Ie=class{constructor(){this.time=0;this.value=0}},qe=class{constructor(){this.evaluate=null,this.basePointIndex=0,this.segmentType=0}},je=class{constructor(){this.type=0,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}},Je=class{constructor(){this.fireTime=0}},Ke=class{constructor(){this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=new _,this.segments=new _,this.points=new _,this.events=new _}},Qs;(n=>(n.CubismMotionCurve=je,n.CubismMotionCurveTarget=$t,n.CubismMotionData=Ke,n.CubismMotionEvent=Je,n.CubismMotionPoint=Ie,n.CubismMotionSegment=qe,n.CubismMotionSegmentType=Gt))(Qs||={});var q="Meta",ea="Duration",ta="Loop",ia="AreBeziersRestricted",ra="CurveCount",sa="Fps",aa="TotalSegmentCount",na="TotalPointCount",_e="Curves",oa="Target",ua="Id",Ht="FadeInTime",Xt="FadeOutTime",lr="Segments",mr="UserData",la="UserDataCount",ma="TotalUserDataSize",ca="Time",ha="Value",Qe=class{constructor(e,t){this._json=L.create(e,t)}release(){L.delete(this._json)}getMotionDuration(){return this._json.getRoot().getValueByString(q).getValueByString(ea).toFloat()}isMotionLoop(){return this._json.getRoot().getValueByString(q).getValueByString(ta).toBoolean()}getEvaluationOptionFlag(e){return e==0?this._json.getRoot().getValueByString(q).getValueByString(ia).toBoolean():!1}getMotionCurveCount(){return this._json.getRoot().getValueByString(q).getValueByString(ra).toInt()}getMotionFps(){return this._json.getRoot().getValueByString(q).getValueByString(sa).toFloat()}getMotionTotalSegmentCount(){return this._json.getRoot().getValueByString(q).getValueByString(aa).toInt()}getMotionTotalPointCount(){return this._json.getRoot().getValueByString(q).getValueByString(na).toInt()}isExistMotionFadeInTime(){return!this._json.getRoot().getValueByString(q).getValueByString(Ht).isNull()}isExistMotionFadeOutTime(){return!this._json.getRoot().getValueByString(q).getValueByString(Xt).isNull()}getMotionFadeInTime(){return this._json.getRoot().getValueByString(q).getValueByString(Ht).toFloat()}getMotionFadeOutTime(){return this._json.getRoot().getValueByString(q).getValueByString(Xt).toFloat()}getMotionCurveTarget(e){return this._json.getRoot().getValueByString(_e).getValueByIndex(e).getValueByString(oa).getRawString()}getMotionCurveId(e){return v.getIdManager().getId(this._json.getRoot().getValueByString(_e).getValueByIndex(e).getValueByString(ua).getRawString())}isExistMotionCurveFadeInTime(e){return!this._json.getRoot().getValueByString(_e).getValueByIndex(e).getValueByString(Ht).isNull()}isExistMotionCurveFadeOutTime(e){return!this._json.getRoot().getValueByString(_e).getValueByIndex(e).getValueByString(Xt).isNull()}getMotionCurveFadeInTime(e){return this._json.getRoot().getValueByString(_e).getValueByIndex(e).getValueByString(Ht).toFloat()}getMotionCurveFadeOutTime(e){return this._json.getRoot().getValueByString(_e).getValueByIndex(e).getValueByString(Xt).toFloat()}getMotionCurveSegmentCount(e){return this._json.getRoot().getValueByString(_e).getValueByIndex(e).getValueByString(lr).getVector().getSize()}getMotionCurveSegment(e,t){return this._json.getRoot().getValueByString(_e).getValueByIndex(e).getValueByString(lr).getValueByIndex(t).toFloat()}getEventCount(){return this._json.getRoot().getValueByString(q).getValueByString(la).toInt()}getTotalEventValueSize(){return this._json.getRoot().getValueByString(q).getValueByString(ma).toInt()}getEventTime(e){return this._json.getRoot().getValueByString(mr).getValueByIndex(e).getValueByString(ca).toFloat()}getEventValue(e){return new D(this._json.getRoot().getValueByString(mr).getValueByIndex(e).getValueByString(ha).getRawString())}};var pa;(e=>e.CubismMotionJson=Qe)(pa||={});var da="EyeBlink",ba="LipSync",_a="Model",fa="Parameter",Ca="PartOpacity",Wt="Opacity",ya=!1;function j(a,e,t){let i=new Ie;return i.time=a.time+(e.time-a.time)*t,i.value=a.value+(e.value-a.value)*t,i}function xa(a,e){let t=(e-a[0].time)/(a[1].time-a[0].time);return t<0&&(t=0),a[0].value+(a[1].value-a[0].value)*t}function Ma(a,e){let t=(e-a[0].time)/(a[3].time-a[0].time);t<0&&(t=0);let i=j(a[0],a[1],t),r=j(a[1],a[2],t),s=j(a[2],a[3],t),o=j(i,r,t),n=j(r,s,t);return j(o,n,t).value}function Sa(a,e){let t=e,i=a[0].time,r=a[3].time,s=a[1].time,o=a[2].time,n=r-3*o+3*s-i,u=3*o-6*s+3*i,m=3*s-3*i,l=i-t,p=S.cardanoAlgorithmForBezier(n,u,m,l),d=j(a[0],a[1],p),c=j(a[1],a[2],p),h=j(a[2],a[3],p),b=j(d,c,p),g=j(c,h,p);return j(b,g,p).value}function Pa(a,e){return a[0].value}function va(a,e){return a[1].value}function Ci(a,e,t){let i=a.curves.at(e),r=-1,s=i.baseSegmentIndex+i.segmentCount,o=0;for(let u=i.baseSegmentIndex;u<s;++u)if(o=a.segments.at(u).basePointIndex+(a.segments.at(u).segmentType==1?3:1),a.points.at(o).time>t){r=u;break}if(r==-1)return a.points.at(o).value;let n=a.segments.at(r);return n.evaluate(a.points.get(n.basePointIndex),t)}var Ze=class a extends Y{static create(e,t,i){let r=new a;return r.parse(e,t),r._sourceFrameRate=r._motionData.fps,r._loopDurationSeconds=r._motionData.duration,r._onFinishedMotion=i,r}doUpdateParameters(e,t,i,r){this._modelCurveIdEyeBlink==null&&(this._modelCurveIdEyeBlink=v.getIdManager().getId(da)),this._modelCurveIdLipSync==null&&(this._modelCurveIdLipSync=v.getIdManager().getId(ba)),this._modelCurveIdOpacity==null&&(this._modelCurveIdOpacity=v.getIdManager().getId(Wt));let s=t-r.getStartTime();s<0&&(s=0);let o=Number.MAX_VALUE,n=Number.MAX_VALUE,u=64,m=0,l=0;this._eyeBlinkParameterIds.getSize()>u&&le("too many eye blink targets : {0}",this._eyeBlinkParameterIds.getSize()),this._lipSyncParameterIds.getSize()>u&&le("too many lip sync targets : {0}",this._lipSyncParameterIds.getSize());let p=this._fadeInSeconds<=0?1:S.getEasingSine((t-r.getFadeInStartTime())/this._fadeInSeconds),d=this._fadeOutSeconds<=0||r.getEndTime()<0?1:S.getEasingSine((r.getEndTime()-t)/this._fadeOutSeconds),c,h,b,g=s;if(this._isLoop)for(;g>this._motionData.duration;)g-=this._motionData.duration;let y=this._motionData.curves;for(h=0;h<this._motionData.curveCount&&y.at(h).type==0;++h)c=Ci(this._motionData,h,g),y.at(h).id==this._modelCurveIdEyeBlink?n=c:y.at(h).id==this._modelCurveIdLipSync?o=c:y.at(h).id==this._modelCurveIdOpacity&&(this._modelOpacity=c,e.setModelOapcity(this.getModelOpacityValue()));let T=0;for(;h<this._motionData.curveCount&&y.at(h).type==1;++h){if(T++,b=e.getParameterIndex(y.at(h).id),b==-1)continue;let C=e.getParameterValueByIndex(b);if(c=Ci(this._motionData,h,g),n!=Number.MAX_VALUE){for(let I=0;I<this._eyeBlinkParameterIds.getSize()&&I<u;++I)if(this._eyeBlinkParameterIds.at(I)==y.at(h).id){c*=n,l|=1<<I;break}}if(o!=Number.MAX_VALUE){for(let I=0;I<this._lipSyncParameterIds.getSize()&&I<u;++I)if(this._lipSyncParameterIds.at(I)==y.at(h).id){c+=o,m|=1<<I;break}}let P;if(y.at(h).fadeInTime<0&&y.at(h).fadeOutTime<0)P=C+(c-C)*i;else{let I,$;y.at(h).fadeInTime<0?I=p:I=y.at(h).fadeInTime==0?1:S.getEasingSine((t-r.getFadeInStartTime())/y.at(h).fadeInTime),y.at(h).fadeOutTime<0?$=d:$=y.at(h).fadeOutTime==0||r.getEndTime()<0?1:S.getEasingSine((r.getEndTime()-t)/y.at(h).fadeOutTime);let G=this._weight*I*$;P=C+(c-C)*G}e.setParameterValueByIndex(b,P,1)}{if(n!=Number.MAX_VALUE)for(let C=0;C<this._eyeBlinkParameterIds.getSize()&&C<u;++C){let P=e.getParameterValueById(this._eyeBlinkParameterIds.at(C));if(l>>C&1)continue;let I=P+(n-P)*i;e.setParameterValueById(this._eyeBlinkParameterIds.at(C),I)}if(o!=Number.MAX_VALUE)for(let C=0;C<this._lipSyncParameterIds.getSize()&&C<u;++C){let P=e.getParameterValueById(this._lipSyncParameterIds.at(C));if(m>>C&1)continue;let I=P+(o-P)*i;e.setParameterValueById(this._lipSyncParameterIds.at(C),I)}}for(;h<this._motionData.curveCount&&y.at(h).type==2;++h)b=e.getParameterIndex(y.at(h).id),b!=-1&&(c=Ci(this._motionData,h,g),e.setParameterValueByIndex(b,c));s>=this._motionData.duration&&(this._isLoop?(r.setStartTime(t),this._isLoopFadeIn&&r.setFadeInStartTime(t)):(this._onFinishedMotion&&this._onFinishedMotion(this),r.setIsFinished(!0))),this._lastWeight=i}setIsLoop(e){this._isLoop=e}isLoop(){return this._isLoop}setIsLoopFadeIn(e){this._isLoopFadeIn=e}isLoopFadeIn(){return this._isLoopFadeIn}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(e,t){let i=this._motionData.curves;for(let r=0;r<this._motionData.curveCount;++r)if(e==i.at(r).id){i.at(r).fadeInTime=t;return}}setParameterFadeOutTime(e,t){let i=this._motionData.curves;for(let r=0;r<this._motionData.curveCount;++r)if(e==i.at(r).id){i.at(r).fadeOutTime=t;return}}getParameterFadeInTime(e){let t=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(e==t.at(i).id)return t.at(i).fadeInTime;return-1}getParameterFadeOutTime(e){let t=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(e==t.at(i).id)return t.at(i).fadeOutTime;return-1}setEffectIds(e,t){this._eyeBlinkParameterIds=e,this._lipSyncParameterIds=t}constructor(){super(),this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0,this._motionData=null,this._modelCurveIdEyeBlink=null,this._modelCurveIdLipSync=null,this._modelCurveIdOpacity=null,this._eyeBlinkParameterIds=null,this._lipSyncParameterIds=null,this._modelOpacity=1}release(){this._motionData=void 0,this._motionData=null}parse(e,t){this._motionData=new Ke;let i=new Qe(e,t);if(!i){i.release(),i=void 0;return}this._motionData.duration=i.getMotionDuration(),this._motionData.loop=i.isMotionLoop(),this._motionData.curveCount=i.getMotionCurveCount(),this._motionData.fps=i.getMotionFps(),this._motionData.eventCount=i.getEventCount();let r=i.getEvaluationOptionFlag(0);i.isExistMotionFadeInTime()?this._fadeInSeconds=i.getMotionFadeInTime()<0?1:i.getMotionFadeInTime():this._fadeInSeconds=1,i.isExistMotionFadeOutTime()?this._fadeOutSeconds=i.getMotionFadeOutTime()<0?1:i.getMotionFadeOutTime():this._fadeOutSeconds=1,this._motionData.curves.updateSize(this._motionData.curveCount,je,!0),this._motionData.segments.updateSize(i.getMotionTotalSegmentCount(),qe,!0),this._motionData.points.updateSize(i.getMotionTotalPointCount(),Ie,!0),this._motionData.events.updateSize(this._motionData.eventCount,Je,!0);let s=0,o=0;for(let n=0;n<this._motionData.curveCount;++n){i.getMotionCurveTarget(n)==_a?this._motionData.curves.at(n).type=0:i.getMotionCurveTarget(n)==fa?this._motionData.curves.at(n).type=1:i.getMotionCurveTarget(n)==Ca?this._motionData.curves.at(n).type=2:W('Warning : Unable to get segment type from Curve! The number of "CurveCount" may be incorrect!'),this._motionData.curves.at(n).id=i.getMotionCurveId(n),this._motionData.curves.at(n).baseSegmentIndex=o,this._motionData.curves.at(n).fadeInTime=i.isExistMotionCurveFadeInTime(n)?i.getMotionCurveFadeInTime(n):-1,this._motionData.curves.at(n).fadeOutTime=i.isExistMotionCurveFadeOutTime(n)?i.getMotionCurveFadeOutTime(n):-1;for(let u=0;u<i.getMotionCurveSegmentCount(n);){switch(u==0?(this._motionData.segments.at(o).basePointIndex=s,this._motionData.points.at(s).time=i.getMotionCurveSegment(n,u),this._motionData.points.at(s).value=i.getMotionCurveSegment(n,u+1),s+=1,u+=2):this._motionData.segments.at(o).basePointIndex=s-1,i.getMotionCurveSegment(n,u)){case 0:{this._motionData.segments.at(o).segmentType=0,this._motionData.segments.at(o).evaluate=xa,this._motionData.points.at(s).time=i.getMotionCurveSegment(n,u+1),this._motionData.points.at(s).value=i.getMotionCurveSegment(n,u+2),s+=1,u+=3;break}case 1:{this._motionData.segments.at(o).segmentType=1,r||ya?this._motionData.segments.at(o).evaluate=Ma:this._motionData.segments.at(o).evaluate=Sa,this._motionData.points.at(s).time=i.getMotionCurveSegment(n,u+1),this._motionData.points.at(s).value=i.getMotionCurveSegment(n,u+2),this._motionData.points.at(s+1).time=i.getMotionCurveSegment(n,u+3),this._motionData.points.at(s+1).value=i.getMotionCurveSegment(n,u+4),this._motionData.points.at(s+2).time=i.getMotionCurveSegment(n,u+5),this._motionData.points.at(s+2).value=i.getMotionCurveSegment(n,u+6),s+=3,u+=7;break}case 2:{this._motionData.segments.at(o).segmentType=2,this._motionData.segments.at(o).evaluate=Pa,this._motionData.points.at(s).time=i.getMotionCurveSegment(n,u+1),this._motionData.points.at(s).value=i.getMotionCurveSegment(n,u+2),s+=1,u+=3;break}case 3:{this._motionData.segments.at(o).segmentType=3,this._motionData.segments.at(o).evaluate=va,this._motionData.points.at(s).time=i.getMotionCurveSegment(n,u+1),this._motionData.points.at(s).value=i.getMotionCurveSegment(n,u+2),s+=1,u+=3;break}default:{z(0);break}}++this._motionData.curves.at(n).segmentCount,++o}}for(let n=0;n<i.getEventCount();++n)this._motionData.events.at(n).fireTime=i.getEventTime(n),this._motionData.events.at(n).value=i.getEventValue(n);i.release(),i=void 0,i=null}getFiredEvent(e,t){this._firedEventValues.updateSize(0);for(let i=0;i<this._motionData.eventCount;++i)this._motionData.events.at(i).fireTime>e&&this._motionData.events.at(i).fireTime<=t&&this._firedEventValues.pushBack(new D(this._motionData.events.at(i).value.s));return this._firedEventValues}isExistModelOpacity(){for(let e=0;e<this._motionData.curveCount;e++){let t=this._motionData.curves.at(e);if(t.type==0&&t.id.getString().s.localeCompare(Wt)==0)return!0}return!1}getModelOpacityIndex(){if(this.isExistModelOpacity())for(let e=0;e<this._motionData.curveCount;e++){let t=this._motionData.curves.at(e);if(t.type==0&&t.id.getString().s.localeCompare(Wt)==0)return e}return-1}getModelOpacityId(e){if(e!=-1){let t=this._motionData.curves.at(e);if(t.type==0&&t.id.getString().s.localeCompare(Wt)==0)return v.getIdManager().getId(t.id.getString().s)}return null}getModelOpacityValue(){return this._modelOpacity}},Va;(e=>e.CubismMotion=Ze)(Va||={});var et=class extends be{constructor(){super(),this._currentPriority=0,this._reservePriority=0}getCurrentPriority(){return this._currentPriority}getReservePriority(){return this._reservePriority}setReservePriority(e){this._reservePriority=e}startMotionPriority(e,t,i){return i==this._reservePriority&&(this._reservePriority=0),this._currentPriority=i,super.startMotion(e,t)}updateMotion(e,t){this._userTimeSeconds+=t;let i=super.doUpdateMotion(e,this._userTimeSeconds);return this.isFinished()&&(this._currentPriority=0),i}reserveMotion(e){return e<=this._reservePriority||e<=this._currentPriority?!1:(this._reservePriority=e,!0)}},Ba;(e=>e.CubismMotionManager=et)(Ba||={});var qt=(e=>(e[e.CubismPhysicsTargetType_Parameter=0]="CubismPhysicsTargetType_Parameter",e))(qt||{}),jt=(i=>(i[i.CubismPhysicsSource_X=0]="CubismPhysicsSource_X",i[i.CubismPhysicsSource_Y=1]="CubismPhysicsSource_Y",i[i.CubismPhysicsSource_Angle=2]="CubismPhysicsSource_Angle",i))(jt||{}),Yt=class{constructor(){this.gravity=new M(0,0),this.wind=new M(0,0)}},tt=class{},it=class{},rt=class{constructor(){this.initialPosition=new M(0,0),this.position=new M(0,0),this.lastPosition=new M(0,0),this.lastGravity=new M(0,0),this.force=new M(0,0),this.velocity=new M(0,0)}},st=class{constructor(){this.normalizationPosition=new it,this.normalizationAngle=new it}},at=class{constructor(){this.source=new tt}},nt=class{constructor(){this.destination=new tt,this.translationScale=new M(0,0)}},ot=class{constructor(){this.settings=new _,this.inputs=new _,this.outputs=new _,this.particles=new _,this.gravity=new M(0,0),this.wind=new M(0,0),this.fps=0}},Ea;(l=>(l.CubismPhysicsInput=at,l.CubismPhysicsNormalization=it,l.CubismPhysicsOutput=nt,l.CubismPhysicsParameter=tt,l.CubismPhysicsParticle=rt,l.CubismPhysicsRig=ot,l.CubismPhysicsSource=jt,l.CubismPhysicsSubRig=st,l.CubismPhysicsTargetType=qt,l.PhysicsJsonEffectiveForces=Yt))(Ea||={});var St="Position",yi="X",xi="Y",Mi="Angle",cr="Type",hr="Id",ne="Meta",Jt="EffectiveForces",Fa="TotalInputCount",Aa="TotalOutputCount",Ra="PhysicsSettingCount",pr="Gravity",gr="Wind",La="VertexCount",Da="Fps",R="PhysicsSettings",ut="Normalization",dr="Minimum",br="Maximum",_r="Default",fr="Reflect",Cr="Weight",Pt="Input",Oa="Source",Be="Output",Na="Scale",ka="VertexIndex",Ua="Destination",Te="Vertices",za="Mobility",$a="Delay",Ga="Radius",Ha="Acceleration",lt=class{constructor(e,t){this._json=L.create(e,t)}release(){L.delete(this._json)}getGravity(){let e=new M(0,0);return e.x=this._json.getRoot().getValueByString(ne).getValueByString(Jt).getValueByString(pr).getValueByString(yi).toFloat(),e.y=this._json.getRoot().getValueByString(ne).getValueByString(Jt).getValueByString(pr).getValueByString(xi).toFloat(),e}getWind(){let e=new M(0,0);return e.x=this._json.getRoot().getValueByString(ne).getValueByString(Jt).getValueByString(gr).getValueByString(yi).toFloat(),e.y=this._json.getRoot().getValueByString(ne).getValueByString(Jt).getValueByString(gr).getValueByString(xi).toFloat(),e}getFps(){return this._json.getRoot().getValueByString(ne).getValueByString(Da).toFloat(0)}getSubRigCount(){return this._json.getRoot().getValueByString(ne).getValueByString(Ra).toInt()}getTotalInputCount(){return this._json.getRoot().getValueByString(ne).getValueByString(Fa).toInt()}getTotalOutputCount(){return this._json.getRoot().getValueByString(ne).getValueByString(Aa).toInt()}getVertexCount(){return this._json.getRoot().getValueByString(ne).getValueByString(La).toInt()}getNormalizationPositionMinimumValue(e){return this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(ut).getValueByString(St).getValueByString(dr).toFloat()}getNormalizationPositionMaximumValue(e){return this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(ut).getValueByString(St).getValueByString(br).toFloat()}getNormalizationPositionDefaultValue(e){return this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(ut).getValueByString(St).getValueByString(_r).toFloat()}getNormalizationAngleMinimumValue(e){return this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(ut).getValueByString(Mi).getValueByString(dr).toFloat()}getNormalizationAngleMaximumValue(e){return this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(ut).getValueByString(Mi).getValueByString(br).toFloat()}getNormalizationAngleDefaultValue(e){return this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(ut).getValueByString(Mi).getValueByString(_r).toFloat()}getInputCount(e){return this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(Pt).getVector().getSize()}getInputWeight(e,t){return this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(Pt).getValueByIndex(t).getValueByString(Cr).toFloat()}getInputReflect(e,t){return this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(Pt).getValueByIndex(t).getValueByString(fr).toBoolean()}getInputType(e,t){return this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(Pt).getValueByIndex(t).getValueByString(cr).getRawString()}getInputSourceId(e,t){return v.getIdManager().getId(this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(Pt).getValueByIndex(t).getValueByString(Oa).getValueByString(hr).getRawString())}getOutputCount(e){return this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(Be).getVector().getSize()}getOutputVertexIndex(e,t){return this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(Be).getValueByIndex(t).getValueByString(ka).toInt()}getOutputAngleScale(e,t){return this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(Be).getValueByIndex(t).getValueByString(Na).toFloat()}getOutputWeight(e,t){return this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(Be).getValueByIndex(t).getValueByString(Cr).toFloat()}getOutputDestinationId(e,t){return v.getIdManager().getId(this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(Be).getValueByIndex(t).getValueByString(Ua).getValueByString(hr).getRawString())}getOutputType(e,t){return this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(Be).getValueByIndex(t).getValueByString(cr).getRawString()}getOutputReflect(e,t){return this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(Be).getValueByIndex(t).getValueByString(fr).toBoolean()}getParticleCount(e){return this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(Te).getVector().getSize()}getParticleMobility(e,t){return this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(Te).getValueByIndex(t).getValueByString(za).toFloat()}getParticleDelay(e,t){return this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(Te).getValueByIndex(t).getValueByString($a).toFloat()}getParticleAcceleration(e,t){return this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(Te).getValueByIndex(t).getValueByString(Ha).toFloat()}getParticleRadius(e,t){return this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(Te).getValueByIndex(t).getValueByString(Ga).toFloat()}getParticlePosition(e,t){let i=new M(0,0);return i.x=this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(Te).getValueByIndex(t).getValueByString(St).getValueByString(yi).toFloat(),i.y=this._json.getRoot().getValueByString(R).getValueByIndex(e).getValueByString(Te).getValueByIndex(t).getValueByString(St).getValueByString(xi).toFloat(),i}},Xa;(e=>e.CubismPhysicsJson=lt)(Xa||={});var yr="X",xr="Y",Mr="Angle",Ya=5,Pi=100,Sr=.001,qa=5,Ee=class a{static create(e,t){let i=new a;return i.parse(e,t),i._physicsRig.gravity.y=0,i}static delete(e){e!=null&&(e.release(),e=null)}parse(e,t){this._physicsRig=new ot;let i=new lt(e,t);this._physicsRig.gravity=i.getGravity(),this._physicsRig.wind=i.getWind(),this._physicsRig.subRigCount=i.getSubRigCount(),this._physicsRig.fps=i.getFps(),this._physicsRig.settings.updateSize(this._physicsRig.subRigCount,st,!0),this._physicsRig.inputs.updateSize(i.getTotalInputCount(),at,!0),this._physicsRig.outputs.updateSize(i.getTotalOutputCount(),nt,!0),this._physicsRig.particles.updateSize(i.getVertexCount(),rt,!0),this._currentRigOutputs.clear(),this._previousRigOutputs.clear();let r=0,s=0,o=0;for(let n=0;n<this._physicsRig.settings.getSize();++n){this._physicsRig.settings.at(n).normalizationPosition.minimum=i.getNormalizationPositionMinimumValue(n),this._physicsRig.settings.at(n).normalizationPosition.maximum=i.getNormalizationPositionMaximumValue(n),this._physicsRig.settings.at(n).normalizationPosition.defalut=i.getNormalizationPositionDefaultValue(n),this._physicsRig.settings.at(n).normalizationAngle.minimum=i.getNormalizationAngleMinimumValue(n),this._physicsRig.settings.at(n).normalizationAngle.maximum=i.getNormalizationAngleMaximumValue(n),this._physicsRig.settings.at(n).normalizationAngle.defalut=i.getNormalizationAngleDefaultValue(n),this._physicsRig.settings.at(n).inputCount=i.getInputCount(n),this._physicsRig.settings.at(n).baseInputIndex=r;for(let l=0;l<this._physicsRig.settings.at(n).inputCount;++l)this._physicsRig.inputs.at(r+l).sourceParameterIndex=-1,this._physicsRig.inputs.at(r+l).weight=i.getInputWeight(n,l),this._physicsRig.inputs.at(r+l).reflect=i.getInputReflect(n,l),i.getInputType(n,l)==yr?(this._physicsRig.inputs.at(r+l).type=0,this._physicsRig.inputs.at(r+l).getNormalizedParameterValue=Ja):i.getInputType(n,l)==xr?(this._physicsRig.inputs.at(r+l).type=1,this._physicsRig.inputs.at(r+l).getNormalizedParameterValue=Ka):i.getInputType(n,l)==Mr&&(this._physicsRig.inputs.at(r+l).type=2,this._physicsRig.inputs.at(r+l).getNormalizedParameterValue=Qa),this._physicsRig.inputs.at(r+l).source.targetType=0,this._physicsRig.inputs.at(r+l).source.id=i.getInputSourceId(n,l);r+=this._physicsRig.settings.at(n).inputCount,this._physicsRig.settings.at(n).outputCount=i.getOutputCount(n),this._physicsRig.settings.at(n).baseOutputIndex=s;let u=new Kt;u.outputs.resize(this._physicsRig.settings.at(n).outputCount);let m=new Kt;m.outputs.resize(this._physicsRig.settings.at(n).outputCount);for(let l=0;l<this._physicsRig.settings.at(n).outputCount;++l)u.outputs.set(l,0),m.outputs.set(l,0),this._physicsRig.outputs.at(s+l).destinationParameterIndex=-1,this._physicsRig.outputs.at(s+l).vertexIndex=i.getOutputVertexIndex(n,l),this._physicsRig.outputs.at(s+l).angleScale=i.getOutputAngleScale(n,l),this._physicsRig.outputs.at(s+l).weight=i.getOutputWeight(n,l),this._physicsRig.outputs.at(s+l).destination.targetType=0,this._physicsRig.outputs.at(s+l).destination.id=i.getOutputDestinationId(n,l),i.getOutputType(n,l)==yr?(this._physicsRig.outputs.at(s+l).type=0,this._physicsRig.outputs.at(s+l).getValue=Za,this._physicsRig.outputs.at(s+l).getScale=an):i.getOutputType(n,l)==xr?(this._physicsRig.outputs.at(s+l).type=1,this._physicsRig.outputs.at(s+l).getValue=en,this._physicsRig.outputs.at(s+l).getScale=nn):i.getOutputType(n,l)==Mr&&(this._physicsRig.outputs.at(s+l).type=2,this._physicsRig.outputs.at(s+l).getValue=tn,this._physicsRig.outputs.at(s+l).getScale=on),this._physicsRig.outputs.at(s+l).reflect=i.getOutputReflect(n,l);this._currentRigOutputs.pushBack(u),this._previousRigOutputs.pushBack(m),s+=this._physicsRig.settings.at(n).outputCount,this._physicsRig.settings.at(n).particleCount=i.getParticleCount(n),this._physicsRig.settings.at(n).baseParticleIndex=o;for(let l=0;l<this._physicsRig.settings.at(n).particleCount;++l)this._physicsRig.particles.at(o+l).mobility=i.getParticleMobility(n,l),this._physicsRig.particles.at(o+l).delay=i.getParticleDelay(n,l),this._physicsRig.particles.at(o+l).acceleration=i.getParticleAcceleration(n,l),this._physicsRig.particles.at(o+l).radius=i.getParticleRadius(n,l),this._physicsRig.particles.at(o+l).position=i.getParticlePosition(n,l);o+=this._physicsRig.settings.at(n).particleCount}this.initialize(),i.release(),i=void 0,i=null}stabilization(e){let t,i,r,s,o=new M,n,u,m,l,p=e.getModel().parameters.values,d=e.getModel().parameters.maximumValues,c=e.getModel().parameters.minimumValues,h=e.getModel().parameters.defaultValues;(this._parameterCaches?.length??0)<e.getParameterCount()&&(this._parameterCaches=new Float32Array(e.getParameterCount())),(this._parameterInputCaches?.length??0)<e.getParameterCount()&&(this._parameterInputCaches=new Float32Array(e.getParameterCount()));for(let b=0;b<e.getParameterCount();++b)this._parameterCaches[b]=p[b],this._parameterInputCaches[b]=p[b];for(let b=0;b<this._physicsRig.subRigCount;++b){t={angle:0},o.x=0,o.y=0,n=this._physicsRig.settings.at(b),u=this._physicsRig.inputs.get(n.baseInputIndex),m=this._physicsRig.outputs.get(n.baseOutputIndex),l=this._physicsRig.particles.get(n.baseParticleIndex);for(let g=0;g<n.inputCount;++g)i=u[g].weight/Pi,u[g].sourceParameterIndex==-1&&(u[g].sourceParameterIndex=e.getParameterIndex(u[g].source.id)),u[g].getNormalizedParameterValue(o,t,p[u[g].sourceParameterIndex],c[u[g].sourceParameterIndex],d[u[g].sourceParameterIndex],h[u[g].sourceParameterIndex],n.normalizationPosition,n.normalizationAngle,u[g].reflect,i),this._parameterCaches[u[g].sourceParameterIndex]=p[u[g].sourceParameterIndex];r=S.degreesToRadian(-t.angle),o.x=o.x*S.cos(r)-o.y*S.sin(r),o.y=o.x*S.sin(r)+o.y*S.cos(r),ln(l,n.particleCount,o,t.angle,this._options.wind,Sr*n.normalizationPosition.maximum);for(let g=0;g<n.outputCount;++g){let y=m[g].vertexIndex;if(m[g].destinationParameterIndex==-1&&(m[g].destinationParameterIndex=e.getParameterIndex(m[g].destination.id)),y<1||y>=n.particleCount)continue;let T=new M;T=l[y].position.substract(l[y-1].position),s=m[g].getValue(T,l,y,m[g].reflect,this._options.gravity),this._currentRigOutputs.at(b).outputs.set(g,s),this._previousRigOutputs.at(b).outputs.set(g,s);let C=m[g].destinationParameterIndex,P=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(p.subarray(C))):p.slice(C);Si(P,c[C],d[C],s,m[g]);for(let I=C,$=0;I<this._parameterCaches.length;I++,$++)p[I]=this._parameterCaches[I]=P[$]}}}evaluate(e,t){let i,r,s,o,n=new M,u,m,l,p;if(0>=t)return;let d=e.getModel().parameters.values,c=e.getModel().parameters.maximumValues,h=e.getModel().parameters.minimumValues,b=e.getModel().parameters.defaultValues,g;if(this._currentRemainTime+=t,this._currentRemainTime>qa&&(this._currentRemainTime=0),(this._parameterCaches?.length??0)<e.getParameterCount()&&(this._parameterCaches=new Float32Array(e.getParameterCount())),(this._parameterInputCaches?.length??0)<e.getParameterCount()){this._parameterInputCaches=new Float32Array(e.getParameterCount());for(let T=0;T<e.getParameterCount();++T)this._parameterInputCaches[T]=d[T]}for(this._physicsRig.fps>0?g=1/this._physicsRig.fps:g=t;this._currentRemainTime>=g;){for(let C=0;C<this._physicsRig.subRigCount;++C){u=this._physicsRig.settings.at(C),l=this._physicsRig.outputs.get(u.baseOutputIndex);for(let P=0;P<u.outputCount;++P)this._previousRigOutputs.at(C).outputs.set(P,this._currentRigOutputs.at(C).outputs.at(P))}let T=g/this._currentRemainTime;for(let C=0;C<e.getParameterCount();++C)this._parameterCaches[C]=this._parameterInputCaches[C]*(1-T)+d[C]*T,this._parameterInputCaches[C]=this._parameterCaches[C];for(let C=0;C<this._physicsRig.subRigCount;++C){i={angle:0},n.x=0,n.y=0,u=this._physicsRig.settings.at(C),m=this._physicsRig.inputs.get(u.baseInputIndex),l=this._physicsRig.outputs.get(u.baseOutputIndex),p=this._physicsRig.particles.get(u.baseParticleIndex);for(let P=0;P<u.inputCount;++P)r=m[P].weight/Pi,m[P].sourceParameterIndex==-1&&(m[P].sourceParameterIndex=e.getParameterIndex(m[P].source.id)),m[P].getNormalizedParameterValue(n,i,this._parameterCaches[m[P].sourceParameterIndex],h[m[P].sourceParameterIndex],c[m[P].sourceParameterIndex],b[m[P].sourceParameterIndex],u.normalizationPosition,u.normalizationAngle,m[P].reflect,r);s=S.degreesToRadian(-i.angle),n.x=n.x*S.cos(s)-n.y*S.sin(s),n.y=n.x*S.sin(s)+n.y*S.cos(s),un(p,u.particleCount,n,i.angle,this._options.wind,Sr*u.normalizationPosition.maximum,g,Ya);for(let P=0;P<u.outputCount;++P){let I=l[P].vertexIndex;if(l[P].destinationParameterIndex==-1&&(l[P].destinationParameterIndex=e.getParameterIndex(l[P].destination.id)),I<1||I>=u.particleCount)continue;let $=new M;$.x=p[I].position.x-p[I-1].position.x,$.y=p[I].position.y-p[I-1].position.y,o=l[P].getValue($,p,I,l[P].reflect,this._options.gravity),this._currentRigOutputs.at(C).outputs.set(P,o);let G=l[P].destinationParameterIndex,Ce=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(this._parameterCaches.subarray(G))):this._parameterCaches.slice(G);Si(Ce,h[G],c[G],o,l[P]);for(let _t=G,ye=0;_t<this._parameterCaches.length;_t++,ye++)this._parameterCaches[_t]=Ce[ye]}}this._currentRemainTime-=g}let y=this._currentRemainTime/g;this.interpolate(e,y)}interpolate(e,t){let i,r,s=e.getModel().parameters.values,o=e.getModel().parameters.maximumValues,n=e.getModel().parameters.minimumValues;for(let u=0;u<this._physicsRig.subRigCount;++u){r=this._physicsRig.settings.at(u),i=this._physicsRig.outputs.get(r.baseOutputIndex);for(let m=0;m<r.outputCount;++m){if(i[m].destinationParameterIndex==-1)continue;let l=i[m].destinationParameterIndex,p=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(s.subarray(l))):s.slice(l);Si(p,n[l],o[l],this._previousRigOutputs.at(u).outputs.at(m)*(1-t)+this._currentRigOutputs.at(u).outputs.at(m)*t,i[m]);for(let d=l,c=0;d<s.length;d++,c++)s[d]=p[c]}}}setOptions(e){this._options=e}getOption(){return this._options}constructor(){this._physicsRig=null,this._options=new vt,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0,this._currentRigOutputs=new _,this._previousRigOutputs=new _,this._currentRemainTime=0,this._parameterCaches=null,this._parameterInputCaches=null}release(){this._physicsRig=void 0,this._physicsRig=null}initialize(){let e,t,i;for(let r=0;r<this._physicsRig.subRigCount;++r){t=this._physicsRig.settings.at(r),e=this._physicsRig.particles.get(t.baseParticleIndex),e[0].initialPosition=new M(0,0),e[0].lastPosition=new M(e[0].initialPosition.x,e[0].initialPosition.y),e[0].lastGravity=new M(0,-1),e[0].lastGravity.y*=-1,e[0].velocity=new M(0,0),e[0].force=new M(0,0);for(let s=1;s<t.particleCount;++s)i=new M(0,0),i.y=e[s].radius,e[s].initialPosition=new M(e[s-1].initialPosition.x+i.x,e[s-1].initialPosition.y+i.y),e[s].position=new M(e[s].initialPosition.x,e[s].initialPosition.y),e[s].lastPosition=new M(e[s].initialPosition.x,e[s].initialPosition.y),e[s].lastGravity=new M(0,-1),e[s].lastGravity.y*=-1,e[s].velocity=new M(0,0),e[s].force=new M(0,0)}}},vt=class{constructor(){this.gravity=new M(0,0),this.wind=new M(0,0)}},Kt=class{constructor(){this.outputs=new _(0)}};function ja(a){let e=0;return a>0?e=1:a<0&&(e=-1),e}function Ja(a,e,t,i,r,s,o,n,u,m){a.x+=vi(t,i,r,s,o.minimum,o.maximum,o.defalut,u)*m}function Ka(a,e,t,i,r,s,o,n,u,m){a.y+=vi(t,i,r,s,o.minimum,o.maximum,o.defalut,u)*m}function Qa(a,e,t,i,r,s,o,n,u,m){e.angle+=vi(t,i,r,s,n.minimum,n.maximum,n.defalut,u)*m}function Za(a,e,t,i,r){let s=a.x;return i&&(s*=-1),s}function en(a,e,t,i,r){let s=a.y;return i&&(s*=-1),s}function tn(a,e,t,i,r){let s;return t>=2?r=e[t-1].position.substract(e[t-2].position):r=r.multiplyByScaler(-1),s=S.directionToRadian(r,a),i&&(s*=-1),s}function rn(a,e){let t=S.max(a,e),i=S.min(a,e);return S.abs(t-i)}function sn(a,e){return S.min(a,e)+rn(a,e)/2}function an(a,e){return JSON.parse(JSON.stringify(a.x))}function nn(a,e){return JSON.parse(JSON.stringify(a.y))}function on(a,e){return JSON.parse(JSON.stringify(e))}function un(a,e,t,i,r,s,o,n){let u,m,l=new M(0,0),p=new M(0,0),d=new M(0,0),c=new M(0,0);a[0].position=new M(t.x,t.y);let h=S.degreesToRadian(i),b=S.radianToDirection(h);b.normalize();for(let g=1;g<e;++g)a[g].force=b.multiplyByScaler(a[g].acceleration).add(r),a[g].lastPosition=new M(a[g].position.x,a[g].position.y),u=a[g].delay*o*30,l=a[g].position.substract(a[g-1].position),m=S.directionToRadian(a[g].lastGravity,b)/n,l.x=S.cos(m)*l.x-l.y*S.sin(m),l.y=S.sin(m)*l.x+l.y*S.cos(m),a[g].position=a[g-1].position.add(l),p=a[g].velocity.multiplyByScaler(u),d=a[g].force.multiplyByScaler(u).multiplyByScaler(u),a[g].position=a[g].position.add(p).add(d),c=a[g].position.substract(a[g-1].position),c.normalize(),a[g].position=a[g-1].position.add(c.multiplyByScaler(a[g].radius)),S.abs(a[g].position.x)<s&&(a[g].position.x=0),u!=0&&(a[g].velocity=a[g].position.substract(a[g].lastPosition),a[g].velocity=a[g].velocity.divisionByScalar(u),a[g].velocity=a[g].velocity.multiplyByScaler(a[g].mobility)),a[g].force=new M(0,0),a[g].lastGravity=new M(b.x,b.y)}function ln(a,e,t,i,r,s){let o=new M(0,0);a[0].position=new M(t.x,t.y);let n=S.degreesToRadian(i),u=S.radianToDirection(n);u.normalize();for(let m=1;m<e;++m)a[m].force=u.multiplyByScaler(a[m].acceleration).add(r),a[m].lastPosition=new M(a[m].position.x,a[m].position.y),a[m].velocity=new M(0,0),o=a[m].force,o.normalize(),o=o.multiplyByScaler(a[m].radius),a[m].position=a[m-1].position.add(o),S.abs(a[m].position.x)<s&&(a[m].position.x=0),a[m].force=new M(0,0),a[m].lastGravity=new M(u.x,u.y)}function Si(a,e,t,i,r){let s,o=r.getScale(r.translationScale,r.angleScale);s=i*o,s<e?(s<r.valueBelowMinimum&&(r.valueBelowMinimum=s),s=e):s>t&&(s>r.valueExceededMaximum&&(r.valueExceededMaximum=s),s=t);let n=r.weight/Pi;n>=1||(s=a[0]*(1-n)+s*n),a[0]=s}function vi(a,e,t,i,r,s,o,n){let u=0,m=S.max(t,e);m<a&&(a=m);let l=S.min(t,e);l>a&&(a=l);let p=S.min(r,s),d=S.max(r,s),c=o,h=sn(l,m),b=a-h;switch(ja(b)){case 1:{let g=d-c,y=m-h;y!=0&&(u=b*(g/y),u+=c);break}case-1:{let g=p-c,y=l-h;y!=0&&(u=b*(g/y),u+=c);break}case 0:{u=c;break}default:break}return n?u:u*-1}var mn;(t=>(t.CubismPhysics=Ee,t.Options=vt))(mn||={});var Vi=4,hn=36,pn=32,Qt=class{constructor(e){this._renderTextureCount=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=new _,this._clippingContextListForDraw=new _,this._channelColors=new _,this._tmpBoundsOnModel=new se,this._tmpMatrix=new A,this._tmpMatrixForMask=new A,this._tmpMatrixForDraw=new A,this._clippingContexttConstructor=e;let t=new N;t.r=1,t.g=0,t.b=0,t.a=0,this._channelColors.pushBack(t),t=new N,t.r=0,t.g=1,t.b=0,t.a=0,this._channelColors.pushBack(t),t=new N,t.r=0,t.g=0,t.b=1,t.a=0,this._channelColors.pushBack(t),t=new N,t.r=0,t.g=0,t.b=0,t.a=1,this._channelColors.pushBack(t)}release(){for(let e=0;e<this._clippingContextListForMask.getSize();e++)this._clippingContextListForMask.at(e)&&(this._clippingContextListForMask.at(e).release(),this._clippingContextListForMask.set(e,void 0)),this._clippingContextListForMask.set(e,null);this._clippingContextListForMask=null;for(let e=0;e<this._clippingContextListForDraw.getSize();e++)this._clippingContextListForDraw.set(e,null);this._clippingContextListForDraw=null;for(let e=0;e<this._channelColors.getSize();e++)this._channelColors.set(e,null);this._channelColors=null,this._clearedFrameBufferFlags!=null&&this._clearedFrameBufferFlags.clear(),this._clearedFrameBufferFlags=null}initialize(e,t){t%1!=0&&(W("The number of render textures must be specified as an integer. The decimal point is rounded down and corrected to an integer."),t=~~t),t<1&&W("The number of render textures must be an integer greater than or equal to 1. Set the number of render textures to 1."),this._renderTextureCount=t<1?1:t,this._clearedFrameBufferFlags=new _(this._renderTextureCount);for(let i=0;i<e.getDrawableCount();i++){if(e.getDrawableMaskCounts()[i]<=0){this._clippingContextListForDraw.pushBack(null);continue}let r=this.findSameClip(e.getDrawableMasks()[i],e.getDrawableMaskCounts()[i]);r==null&&(r=new this._clippingContexttConstructor(this,e.getDrawableMasks()[i],e.getDrawableMaskCounts()[i]),this._clippingContextListForMask.pushBack(r)),r.addClippedDrawable(i),this._clippingContextListForDraw.pushBack(r)}}findSameClip(e,t){for(let i=0;i<this._clippingContextListForMask.getSize();i++){let r=this._clippingContextListForMask.at(i),s=r._clippingIdCount;if(s!=t)continue;let o=0;for(let n=0;n<s;n++){let u=r._clippingIdList[n];for(let m=0;m<s;m++)if(e[m]==u){o++;break}}if(o==s)return r}return null}setupMatrixForHighPrecision(e,t){let i=0;for(let r=0;r<this._clippingContextListForMask.getSize();r++){let s=this._clippingContextListForMask.at(r);this.calcClippedDrawTotalBounds(e,s),s._isUsing&&i++}if(i>0){if(this.setupLayoutBounds(0),this._clearedFrameBufferFlags.getSize()!=this._renderTextureCount){this._clearedFrameBufferFlags.clear();for(let r=0;r<this._renderTextureCount;r++)this._clearedFrameBufferFlags.pushBack(!1)}else for(let r=0;r<this._renderTextureCount;r++)this._clearedFrameBufferFlags.set(r,!1);for(let r=0;r<this._clippingContextListForMask.getSize();r++){let s=this._clippingContextListForMask.at(r),o=s._allClippedDrawRect,n=s._layoutBounds,u=.05,m=0,l=0,p=e.getPixelsPerUnit(),d=s.getClippingManager().getClippingMaskBufferSize(),c=n.width*d,h=n.height*d;this._tmpBoundsOnModel.setRect(o),this._tmpBoundsOnModel.width*p>c?(this._tmpBoundsOnModel.expand(o.width*u,0),m=n.width/this._tmpBoundsOnModel.width):m=p/c,this._tmpBoundsOnModel.height*p>h?(this._tmpBoundsOnModel.expand(0,o.height*u),l=n.height/this._tmpBoundsOnModel.height):l=p/h,this.createMatrixForMask(t,n,m,l),s._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),s._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray())}}}createMatrixForMask(e,t,i,r){this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(t.x,t.y),this._tmpMatrix.scaleRelative(i,r),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(t.x,t.y*(e?-1:1)),this._tmpMatrix.scaleRelative(i,r*(e?-1:1)),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray())}setupLayoutBounds(e){let t=this._renderTextureCount<=1?hn:pn*this._renderTextureCount;if(e<=0||e>t){e>t&&B(`not supported mask count : {0}
[Details] render texture count : {1}, mask count : {2}`,e-t,this._renderTextureCount,e);for(let m=0;m<this._clippingContextListForMask.getSize();m++){let l=this._clippingContextListForMask.at(m);l._layoutChannelIndex=0,l._layoutBounds.x=0,l._layoutBounds.y=0,l._layoutBounds.width=1,l._layoutBounds.height=1,l._bufferIndex=0}return}let i=this._renderTextureCount<=1?9:8,r=e/this._renderTextureCount,s=e%this._renderTextureCount;r=Math.ceil(r);let o=r/Vi,n=r%Vi;o=~~o;let u=0;for(let m=0;m<this._renderTextureCount;m++)for(let l=0;l<Vi;l++){let p=o+(l<n?1:0),d=n+(o<1?-1:0);if(l==d&&s>0&&(p-=m<s?0:1),p!=0)if(p==1){let c=this._clippingContextListForMask.at(u++);c._layoutChannelIndex=l,c._layoutBounds.x=0,c._layoutBounds.y=0,c._layoutBounds.width=1,c._layoutBounds.height=1,c._bufferIndex=m}else if(p==2)for(let c=0;c<p;c++){let h=c%2;h=~~h;let b=this._clippingContextListForMask.at(u++);b._layoutChannelIndex=l,b._layoutBounds.x=h*.5,b._layoutBounds.y=0,b._layoutBounds.width=.5,b._layoutBounds.height=1,b._bufferIndex=m}else if(p<=4)for(let c=0;c<p;c++){let h=c%2,b=c/2;h=~~h,b=~~b;let g=this._clippingContextListForMask.at(u++);g._layoutChannelIndex=l,g._layoutBounds.x=h*.5,g._layoutBounds.y=b*.5,g._layoutBounds.width=.5,g._layoutBounds.height=.5,g._bufferIndex=m}else if(p<=i)for(let c=0;c<p;c++){let h=c%3,b=c/3;h=~~h,b=~~b;let g=this._clippingContextListForMask.at(u++);g._layoutChannelIndex=l,g._layoutBounds.x=h/3,g._layoutBounds.y=b/3,g._layoutBounds.width=1/3,g._layoutBounds.height=1/3,g._bufferIndex=m}else{B(`not supported mask count : {0}
[Details] render texture count : {1}, mask count : {2}`,e-t,this._renderTextureCount,e);for(let c=0;c<p;c++){let h=this._clippingContextListForMask.at(u++);h._layoutChannelIndex=0,h._layoutBounds.x=0,h._layoutBounds.y=0,h._layoutBounds.width=1,h._layoutBounds.height=1,h._bufferIndex=0}}}}calcClippedDrawTotalBounds(e,t){let i=Number.MAX_VALUE,r=Number.MAX_VALUE,s=Number.MIN_VALUE,o=Number.MIN_VALUE,n=t._clippedDrawableIndexList.length;for(let u=0;u<n;u++){let m=t._clippedDrawableIndexList[u],l=e.getDrawableVertexCount(m),p=e.getDrawableVertices(m),d=Number.MAX_VALUE,c=Number.MAX_VALUE,h=-Number.MAX_VALUE,b=-Number.MAX_VALUE,g=l*Q.vertexStep;for(let y=Q.vertexOffset;y<g;y+=Q.vertexStep){let T=p[y],C=p[y+1];T<d&&(d=T),T>h&&(h=T),C<c&&(c=C),C>b&&(b=C)}if(d!=Number.MAX_VALUE)if(d<i&&(i=d),c<r&&(r=c),h>s&&(s=h),b>o&&(o=b),i==Number.MAX_VALUE)t._allClippedDrawRect.x=0,t._allClippedDrawRect.y=0,t._allClippedDrawRect.width=0,t._allClippedDrawRect.height=0,t._isUsing=!1;else{t._isUsing=!0;let y=s-i,T=o-r;t._allClippedDrawRect.x=i,t._allClippedDrawRect.y=r,t._allClippedDrawRect.width=y,t._allClippedDrawRect.height=T}}}getClippingContextListForDraw(){return this._clippingContextListForDraw}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}getRenderTextureCount(){return this._renderTextureCount}getChannelFlagAsColor(e){return this._channelColors.at(e)}setClippingMaskBufferSize(e){this._clippingMaskBufferSize=e}};var we,gn=10,oe=class a{static getInstance(){return we==null&&(we=new a),we}static deleteInstance(){we&&(we.release(),we=null)}constructor(){this._shaderSets=new _}release(){this.releaseShaderProgram()}setupShaderProgramForDraw(e,t,i){e.isPremultipliedAlpha()||B("NoPremultipliedAlpha is not allowed"),this._shaderSets.getSize()==0&&this.generateShaders();let r,s,o,n,u=e.getClippingContextBufferForDraw()!=null,m=t.getDrawableInvertedMaskBit(i),l=u?m?2:1:0,p;switch(t.getDrawableBlendMode(i)){case 0:default:p=this._shaderSets.at(1+l),r=this.gl.ONE,s=this.gl.ONE_MINUS_SRC_ALPHA,o=this.gl.ONE,n=this.gl.ONE_MINUS_SRC_ALPHA;break;case 1:p=this._shaderSets.at(4+l),r=this.gl.ONE,s=this.gl.ONE,o=this.gl.ZERO,n=this.gl.ONE;break;case 2:p=this._shaderSets.at(7+l),r=this.gl.DST_COLOR,s=this.gl.ONE_MINUS_SRC_ALPHA,o=this.gl.ZERO,n=this.gl.ONE;break}this.gl.useProgram(p.shaderProgram),e._bufferData.vertex==null&&(e._bufferData.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e._bufferData.vertex);let d=t.getDrawableVertices(i);this.gl.bufferData(this.gl.ARRAY_BUFFER,d,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(p.attributePositionLocation),this.gl.vertexAttribPointer(p.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),e._bufferData.uv==null&&(e._bufferData.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e._bufferData.uv);let c=t.getDrawableVertexUvs(i);if(this.gl.bufferData(this.gl.ARRAY_BUFFER,c,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(p.attributeTexCoordLocation),this.gl.vertexAttribPointer(p.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),u){this.gl.activeTexture(this.gl.TEXTURE1);let I=e.getClippingContextBufferForDraw().getClippingManager().getColorBuffer().at(e.getClippingContextBufferForDraw()._bufferIndex);this.gl.bindTexture(this.gl.TEXTURE_2D,I),this.gl.uniform1i(p.samplerTexture1Location,1),this.gl.uniformMatrix4fv(p.uniformClipMatrixLocation,!1,e.getClippingContextBufferForDraw()._matrixForDraw.getArray());let $=e.getClippingContextBufferForDraw()._layoutChannelIndex,G=e.getClippingContextBufferForDraw().getClippingManager().getChannelFlagAsColor($);this.gl.uniform4f(p.uniformChannelFlagLocation,G.r,G.g,G.b,G.a)}let h=t.getDrawableTextureIndex(i),b=e.getBindedTextures().getValue(h);this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,b),this.gl.uniform1i(p.samplerTexture0Location,0);let g=e.getMvpMatrix();this.gl.uniformMatrix4fv(p.uniformMatrixLocation,!1,g.getArray());let y=e.getModelColorWithOpacity(t.getDrawableOpacity(i)),T=t.getMultiplyColor(i),C=t.getScreenColor(i);this.gl.uniform4f(p.uniformBaseColorLocation,y.r,y.g,y.b,y.a),this.gl.uniform4f(p.uniformMultiplyColorLocation,T.r,T.g,T.b,T.a),this.gl.uniform4f(p.uniformScreenColorLocation,C.r,C.g,C.b,C.a),e._bufferData.index==null&&(e._bufferData.index=this.gl.createBuffer());let P=t.getDrawableVertexIndices(i);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,e._bufferData.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,P,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(r,s,o,n)}setupShaderProgramForMask(e,t,i){e.isPremultipliedAlpha()||B("NoPremultipliedAlpha is not allowed"),this._shaderSets.getSize()==0&&this.generateShaders();let r=this._shaderSets.at(0);this.gl.useProgram(r.shaderProgram),e._bufferData.vertex==null&&(e._bufferData.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e._bufferData.vertex);let s=t.getDrawableVertices(i);this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(r.attributePositionLocation),this.gl.vertexAttribPointer(r.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),e._bufferData.uv==null&&(e._bufferData.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e._bufferData.uv);let o=t.getDrawableTextureIndex(i),n=e.getBindedTextures().getValue(o);this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,n),this.gl.uniform1i(r.samplerTexture0Location,0),e._bufferData.uv==null&&(e._bufferData.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e._bufferData.uv);let u=t.getDrawableVertexUvs(i);this.gl.bufferData(this.gl.ARRAY_BUFFER,u,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(r.attributeTexCoordLocation),this.gl.vertexAttribPointer(r.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0);let m=e.getClippingContextBufferForMask(),l=e.getClippingContextBufferForMask()._layoutChannelIndex,p=e.getClippingContextBufferForMask().getClippingManager().getChannelFlagAsColor(l);this.gl.uniform4f(r.uniformChannelFlagLocation,p.r,p.g,p.b,p.a),this.gl.uniformMatrix4fv(r.uniformClipMatrixLocation,!1,e.getClippingContextBufferForMask()._matrixForMask.getArray());let d=e.getClippingContextBufferForMask()._layoutBounds;this.gl.uniform4f(r.uniformBaseColorLocation,d.x*2-1,d.y*2-1,d.getRight()*2-1,d.getBottom()*2-1);let c=t.getMultiplyColor(i),h=t.getScreenColor(i);this.gl.uniform4f(r.uniformMultiplyColorLocation,c.r,c.g,c.b,c.a),this.gl.uniform4f(r.uniformScreenColorLocation,h.r,h.g,h.b,h.a);let b=this.gl.ZERO,g=this.gl.ONE_MINUS_SRC_COLOR,y=this.gl.ZERO,T=this.gl.ONE_MINUS_SRC_ALPHA;e._bufferData.index==null&&(e._bufferData.index=this.gl.createBuffer());let C=t.getDrawableVertexIndices(i);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,e._bufferData.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,C,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(b,g,y,T)}releaseShaderProgram(){for(let e=0;e<this._shaderSets.getSize();e++)this.gl.deleteProgram(this._shaderSets.at(e).shaderProgram),this._shaderSets.at(e).shaderProgram=0,this._shaderSets.set(e,void 0),this._shaderSets.set(e,null)}generateShaders(){for(let e=0;e<gn;e++)this._shaderSets.pushBack(new Vt);this._shaderSets.at(0).shaderProgram=this.loadShaderProgram(dn,bn),this._shaderSets.at(1).shaderProgram=this.loadShaderProgram(_n,fn),this._shaderSets.at(2).shaderProgram=this.loadShaderProgram(Pr,Cn),this._shaderSets.at(3).shaderProgram=this.loadShaderProgram(Pr,yn),this._shaderSets.at(4).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(5).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(6).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(7).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(8).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(9).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(0).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_position"),this._shaderSets.at(0).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_texCoord"),this._shaderSets.at(0).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"s_texture0"),this._shaderSets.at(0).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_clipMatrix"),this._shaderSets.at(0).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_channelFlag"),this._shaderSets.at(0).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_baseColor"),this._shaderSets.at(0).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_multiplyColor"),this._shaderSets.at(0).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_screenColor"),this._shaderSets.at(1).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_position"),this._shaderSets.at(1).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_texCoord"),this._shaderSets.at(1).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"s_texture0"),this._shaderSets.at(1).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_matrix"),this._shaderSets.at(1).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_baseColor"),this._shaderSets.at(1).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_multiplyColor"),this._shaderSets.at(1).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_screenColor"),this._shaderSets.at(2).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_position"),this._shaderSets.at(2).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_texCoord"),this._shaderSets.at(2).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture0"),this._shaderSets.at(2).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture1"),this._shaderSets.at(2).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_matrix"),this._shaderSets.at(2).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_clipMatrix"),this._shaderSets.at(2).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_channelFlag"),this._shaderSets.at(2).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_baseColor"),this._shaderSets.at(2).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_multiplyColor"),this._shaderSets.at(2).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_screenColor"),this._shaderSets.at(3).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_position"),this._shaderSets.at(3).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_texCoord"),this._shaderSets.at(3).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture0"),this._shaderSets.at(3).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture1"),this._shaderSets.at(3).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_matrix"),this._shaderSets.at(3).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_clipMatrix"),this._shaderSets.at(3).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_channelFlag"),this._shaderSets.at(3).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_baseColor"),this._shaderSets.at(3).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_multiplyColor"),this._shaderSets.at(3).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_screenColor"),this._shaderSets.at(4).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_position"),this._shaderSets.at(4).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_texCoord"),this._shaderSets.at(4).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"s_texture0"),this._shaderSets.at(4).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_matrix"),this._shaderSets.at(4).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_baseColor"),this._shaderSets.at(4).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_multiplyColor"),this._shaderSets.at(4).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_screenColor"),this._shaderSets.at(5).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_position"),this._shaderSets.at(5).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_texCoord"),this._shaderSets.at(5).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture0"),this._shaderSets.at(5).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture1"),this._shaderSets.at(5).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_matrix"),this._shaderSets.at(5).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_clipMatrix"),this._shaderSets.at(5).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_channelFlag"),this._shaderSets.at(5).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_baseColor"),this._shaderSets.at(5).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_multiplyColor"),this._shaderSets.at(5).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_screenColor"),this._shaderSets.at(6).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_position"),this._shaderSets.at(6).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_texCoord"),this._shaderSets.at(6).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture0"),this._shaderSets.at(6).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture1"),this._shaderSets.at(6).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_matrix"),this._shaderSets.at(6).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_clipMatrix"),this._shaderSets.at(6).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_channelFlag"),this._shaderSets.at(6).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_baseColor"),this._shaderSets.at(6).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_multiplyColor"),this._shaderSets.at(6).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_screenColor"),this._shaderSets.at(7).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_position"),this._shaderSets.at(7).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_texCoord"),this._shaderSets.at(7).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"s_texture0"),this._shaderSets.at(7).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_matrix"),this._shaderSets.at(7).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_baseColor"),this._shaderSets.at(7).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_multiplyColor"),this._shaderSets.at(7).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_screenColor"),this._shaderSets.at(8).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_position"),this._shaderSets.at(8).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_texCoord"),this._shaderSets.at(8).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture0"),this._shaderSets.at(8).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture1"),this._shaderSets.at(8).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_matrix"),this._shaderSets.at(8).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_clipMatrix"),this._shaderSets.at(8).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_channelFlag"),this._shaderSets.at(8).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_baseColor"),this._shaderSets.at(8).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_multiplyColor"),this._shaderSets.at(8).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_screenColor"),this._shaderSets.at(9).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_position"),this._shaderSets.at(9).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_texCoord"),this._shaderSets.at(9).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture0"),this._shaderSets.at(9).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture1"),this._shaderSets.at(9).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_matrix"),this._shaderSets.at(9).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_clipMatrix"),this._shaderSets.at(9).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_channelFlag"),this._shaderSets.at(9).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_baseColor"),this._shaderSets.at(9).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_multiplyColor"),this._shaderSets.at(9).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_screenColor")}loadShaderProgram(e,t){let i=this.gl.createProgram(),r=this.compileShaderSource(this.gl.VERTEX_SHADER,e);if(!r)return B("Vertex shader compile error!"),0;let s=this.compileShaderSource(this.gl.FRAGMENT_SHADER,t);return s?(this.gl.attachShader(i,r),this.gl.attachShader(i,s),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?(this.gl.deleteShader(r),this.gl.deleteShader(s),i):(B("Failed to link program: {0}",i),this.gl.deleteShader(r),r=0,this.gl.deleteShader(s),s=0,i&&(this.gl.deleteProgram(i),i=0),0)):(B("Vertex shader compile error!"),0)}compileShaderSource(e,t){let i=t,r=this.gl.createShader(e);if(this.gl.shaderSource(r,i),this.gl.compileShader(r),!r){let o=this.gl.getShaderInfoLog(r);B("Shader compile log: {0} ",o)}return this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)?r:(this.gl.deleteShader(r),null)}setGl(e){this.gl=e}},Vt=class{},Ii=(l=>(l[l.ShaderNames_SetupMask=0]="ShaderNames_SetupMask",l[l.ShaderNames_NormalPremultipliedAlpha=1]="ShaderNames_NormalPremultipliedAlpha",l[l.ShaderNames_NormalMaskedPremultipliedAlpha=2]="ShaderNames_NormalMaskedPremultipliedAlpha",l[l.ShaderNames_NomralMaskedInvertedPremultipliedAlpha=3]="ShaderNames_NomralMaskedInvertedPremultipliedAlpha",l[l.ShaderNames_AddPremultipliedAlpha=4]="ShaderNames_AddPremultipliedAlpha",l[l.ShaderNames_AddMaskedPremultipliedAlpha=5]="ShaderNames_AddMaskedPremultipliedAlpha",l[l.ShaderNames_AddMaskedPremultipliedAlphaInverted=6]="ShaderNames_AddMaskedPremultipliedAlphaInverted",l[l.ShaderNames_MultPremultipliedAlpha=7]="ShaderNames_MultPremultipliedAlpha",l[l.ShaderNames_MultMaskedPremultipliedAlpha=8]="ShaderNames_MultMaskedPremultipliedAlpha",l[l.ShaderNames_MultMaskedPremultipliedAlphaInverted=9]="ShaderNames_MultMaskedPremultipliedAlphaInverted",l))(Ii||{}),dn="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",bn="precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}",_n="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",Pr="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",fn="precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 color = texColor * u_baseColor;   gl_FragColor = vec4(color.rgb, color.a);}",Cn="precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}",yn="precision mediump float;varying vec2      v_texCoord;varying vec4      v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4      u_channelFlag;uniform vec4      u_baseColor;uniform vec4      u_multiplyColor;uniform vec4      u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * (1.0 - maskVal);   gl_FragColor = col_formask;}",xn;(i=>(i.CubismShaderSet=Vt,i.CubismShader_WebGL=oe,i.ShaderNames=Ii))(xn||={});var ue,Zt,mt=class extends Qt{getMaskRenderTexture(){if(this._maskTexture&&this._maskTexture.textures!=null)this._maskTexture.frameNo=this._currentFrameNo;else{this._maskRenderTextures!=null&&this._maskRenderTextures.clear(),this._maskRenderTextures=new _,this._maskColorBuffers!=null&&this._maskColorBuffers.clear(),this._maskColorBuffers=new _;let e=this._clippingMaskBufferSize;for(let t=0;t<this._renderTextureCount;t++)this._maskColorBuffers.pushBack(this.gl.createTexture()),this.gl.bindTexture(this.gl.TEXTURE_2D,this._maskColorBuffers.at(t)),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,e,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this._maskRenderTextures.pushBack(this.gl.createFramebuffer()),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTextures.at(t)),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._maskColorBuffers.at(t),0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Zt),this._maskTexture=new It(this._currentFrameNo,this._maskRenderTextures)}return this._maskTexture.textures}setGL(e){this.gl=e}constructor(){super(Bt)}setupClippingContext(e,t){this._currentFrameNo++;let i=0;for(let r=0;r<this._clippingContextListForMask.getSize();r++){let s=this._clippingContextListForMask.at(r);this.calcClippedDrawTotalBounds(e,s),s._isUsing&&i++}if(i>0){this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._currentMaskRenderTexture=this.getMaskRenderTexture().at(0),t.preDraw(),this.setupLayoutBounds(i),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture),this._clearedFrameBufferFlags.getSize()!=this._renderTextureCount&&(this._clearedFrameBufferFlags.clear(),this._clearedFrameBufferFlags=new _(this._renderTextureCount));for(let r=0;r<this._clearedFrameBufferFlags.getSize();r++)this._clearedFrameBufferFlags.set(r,!1);for(let r=0;r<this._clippingContextListForMask.getSize();r++){let s=this._clippingContextListForMask.at(r),o=s._allClippedDrawRect,n=s._layoutBounds,u=.05,m=0,l=0,p=this.getMaskRenderTexture().at(s._bufferIndex);this._currentMaskRenderTexture!=p&&(this._currentMaskRenderTexture=p,t.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),this._tmpBoundsOnModel.setRect(o),this._tmpBoundsOnModel.expand(o.width*u,o.height*u),m=n.width/this._tmpBoundsOnModel.width,l=n.height/this._tmpBoundsOnModel.height,this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(n.x,n.y),this._tmpMatrix.scaleRelative(m,l),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(n.x,n.y),this._tmpMatrix.scaleRelative(m,l),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),s._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),s._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray());let d=s._clippingIdCount;for(let c=0;c<d;c++){let h=s._clippingIdList[c];e.getDrawableDynamicFlagVertexPositionsDidChange(h)&&(t.setIsCulling(e.getDrawableCulling(h)!=!1),this._clearedFrameBufferFlags.at(s._bufferIndex)||(this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this._clearedFrameBufferFlags.set(s._bufferIndex,!0)),t.setClippingContextBufferForMask(s),t.drawMeshWebGL(e,h))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Zt),t.setClippingContextBufferForMask(null),this.gl.viewport(ue[0],ue[1],ue[2],ue[3])}}getColorBuffer(){return this._maskColorBuffers}getClippingMaskCount(){return this._clippingContextListForMask.getSize()}},It=class{constructor(e,t){this.frameNo=e,this.textures=t}},Bt=class extends wt{constructor(e,t,i){super(t,i),this._owner=e}getClippingManager(){return this._owner}setGl(e){this._owner.setGL(e)}},Bi=class{setGlEnable(e,t){t?this.gl.enable(e):this.gl.disable(e)}setGlEnableVertexAttribArray(e,t){t?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e)}save(){if(this.gl==null){B(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING),this._lastElementArrayBufferBinding=this.gl.getParameter(this.gl.ELEMENT_ARRAY_BUFFER_BINDING),this._lastProgram=this.gl.getParameter(this.gl.CURRENT_PROGRAM),this._lastActiveTexture=this.gl.getParameter(this.gl.ACTIVE_TEXTURE),this.gl.activeTexture(this.gl.TEXTURE1),this._lastTexture1Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this.gl.activeTexture(this.gl.TEXTURE0),this._lastTexture0Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this._lastVertexAttribArrayEnabled[0]=this.gl.getVertexAttrib(0,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[1]=this.gl.getVertexAttrib(1,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[2]=this.gl.getVertexAttrib(2,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[3]=this.gl.getVertexAttrib(3,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastScissorTest=this.gl.isEnabled(this.gl.SCISSOR_TEST),this._lastStencilTest=this.gl.isEnabled(this.gl.STENCIL_TEST),this._lastDepthTest=this.gl.isEnabled(this.gl.DEPTH_TEST),this._lastCullFace=this.gl.isEnabled(this.gl.CULL_FACE),this._lastBlend=this.gl.isEnabled(this.gl.BLEND),this._lastFrontFace=this.gl.getParameter(this.gl.FRONT_FACE),this._lastColorMask=this.gl.getParameter(this.gl.COLOR_WRITEMASK),this._lastBlending[0]=this.gl.getParameter(this.gl.BLEND_SRC_RGB),this._lastBlending[1]=this.gl.getParameter(this.gl.BLEND_DST_RGB),this._lastBlending[2]=this.gl.getParameter(this.gl.BLEND_SRC_ALPHA),this._lastBlending[3]=this.gl.getParameter(this.gl.BLEND_DST_ALPHA),this._lastFBO=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),this._lastViewport=this.gl.getParameter(this.gl.VIEWPORT)}restore(){if(this.gl==null){B(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this.gl.useProgram(this._lastProgram),this.setGlEnableVertexAttribArray(0,this._lastVertexAttribArrayEnabled[0]),this.setGlEnableVertexAttribArray(1,this._lastVertexAttribArrayEnabled[1]),this.setGlEnableVertexAttribArray(2,this._lastVertexAttribArrayEnabled[2]),this.setGlEnableVertexAttribArray(3,this._lastVertexAttribArrayEnabled[3]),this.setGlEnable(this.gl.SCISSOR_TEST,this._lastScissorTest),this.setGlEnable(this.gl.STENCIL_TEST,this._lastStencilTest),this.setGlEnable(this.gl.DEPTH_TEST,this._lastDepthTest),this.setGlEnable(this.gl.CULL_FACE,this._lastCullFace),this.setGlEnable(this.gl.BLEND,this._lastBlend),this.gl.frontFace(this._lastFrontFace),this.gl.colorMask(this._lastColorMask[0],this._lastColorMask[1],this._lastColorMask[2],this._lastColorMask[3]),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._lastArrayBufferBinding),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this._lastElementArrayBufferBinding),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture1Binding2D),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture0Binding2D),this.gl.activeTexture(this._lastActiveTexture),this.gl.blendFuncSeparate(this._lastBlending[0],this._lastBlending[1],this._lastBlending[2],this._lastBlending[3])}setGl(e){this.gl=e}constructor(){this._lastVertexAttribArrayEnabled=new Array(4),this._lastColorMask=new Array(4),this._lastBlending=new Array(4),this._lastViewport=new Array(4)}},Fe=class extends ae{initialize(e,t=1){e.isUsingMasking()&&(this._clippingManager=new mt,this._clippingManager.initialize(e,t)),this._sortedDrawableIndexList.resize(e.getDrawableCount(),0),super.initialize(e)}bindTexture(e,t){this._textures.setValue(e,t)}getBindedTextures(){return this._textures}setClippingMaskBufferSize(e){if(!this._model.isUsingMasking())return;let t=this._clippingManager.getRenderTextureCount();this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null,this._clippingManager=new mt,this._clippingManager.setClippingMaskBufferSize(e),this._clippingManager.initialize(this.getModel(),t)}getClippingMaskBufferSize(){return this._model.isUsingMasking()?this._clippingManager.getClippingMaskBufferSize():-1}getRenderTextureCount(){return this._model.isUsingMasking()?this._clippingManager.getRenderTextureCount():-1}constructor(){super(),this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._rendererProfile=new Bi,this.firstDraw=!0,this._textures=new k,this._sortedDrawableIndexList=new _,this._bufferData={vertex:WebGLBuffer=null,uv:WebGLBuffer=null,index:WebGLBuffer=null},this._textures.prepareCapacity(32,!0)}release(){this._clippingManager&&(this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null),this.gl!=null&&(this.gl.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,this.gl.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,this.gl.deleteBuffer(this._bufferData.index),this._bufferData.index=null,this._bufferData=null,this._textures=null)}doDrawModel(){if(this.gl==null){B(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this._clippingManager!=null&&(this.preDraw(),this.isUsingHighPrecisionMask()?this._clippingManager.setupMatrixForHighPrecision(this.getModel(),!1):this._clippingManager.setupClippingContext(this.getModel(),this)),this.preDraw();let e=this.getModel().getDrawableCount(),t=this.getModel().getDrawableRenderOrders();for(let i=0;i<e;++i){let r=t[i];this._sortedDrawableIndexList.set(r,i)}for(let i=0;i<e;++i){let r=this._sortedDrawableIndexList.at(i);if(!this.getModel().getDrawableDynamicFlagIsVisible(r))continue;let s=this._clippingManager!=null?this._clippingManager.getClippingContextListForDraw().at(r):null;if(s!=null&&this.isUsingHighPrecisionMask()){s._isUsing&&(this.gl.viewport(0,0,this._clippingManager.getClippingMaskBufferSize(),this._clippingManager.getClippingMaskBufferSize()),this.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,s.getClippingManager().getMaskRenderTexture().at(s._bufferIndex)),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT));{let o=s._clippingIdCount;for(let n=0;n<o;n++){let u=s._clippingIdList[n];this._model.getDrawableDynamicFlagVertexPositionsDidChange(u)&&(this.setIsCulling(this._model.getDrawableCulling(u)!=!1),this.setClippingContextBufferForMask(s),this.drawMeshWebGL(this._model,u))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Zt),this.setClippingContextBufferForMask(null),this.gl.viewport(ue[0],ue[1],ue[2],ue[3]),this.preDraw()}this.setClippingContextBufferForDraw(s),this.setIsCulling(this.getModel().getDrawableCulling(r)),this.drawMeshWebGL(this._model,r)}}drawMeshWebGL(e,t){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW),this.isGeneratingMask()?oe.getInstance().setupShaderProgramForMask(this,e,t):oe.getInstance().setupShaderProgramForDraw(this,e,t);{let i=e.getDrawableVertexIndexCount(t);this.gl.drawElements(this.gl.TRIANGLES,i,this.gl.UNSIGNED_SHORT,0)}this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}saveProfile(){this._rendererProfile.save()}restoreProfile(){this._rendererProfile.restore()}static doStaticRelease(){oe.deleteInstance()}setRenderState(e,t){Zt=e,ue=t}preDraw(){if(this.firstDraw&&(this.firstDraw=!1),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),this.getAnisotropy()>0&&this._extension)for(let e=0;e<this._textures.getSize();++e)this.gl.bindTexture(this.gl.TEXTURE_2D,this._textures.getValue(e)),this.gl.texParameterf(this.gl.TEXTURE_2D,this._extension.TEXTURE_MAX_ANISOTROPY_EXT,this.getAnisotropy())}setClippingContextBufferForMask(e){this._clippingContextBufferForMask=e}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(e){this._clippingContextBufferForDraw=e}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}isGeneratingMask(){return this.getClippingContextBufferForMask()!=null}startUp(e){this.gl=e,this._clippingManager&&this._clippingManager.setGL(e),oe.getInstance().setGl(e),this._rendererProfile.setGl(e),this._extension=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")}};ae.staticRelease=()=>{Fe.doStaticRelease()};var Sn;(r=>(r.CubismClippingContext=Bt,r.CubismClippingManager_WebGL=mt,r.CubismRenderTextureResource=It,r.CubismRenderer_WebGL=Fe))(Sn||={});var ei=class{constructor(e=!1,t=new N){this.isOverwritten=e,this.color=t}},ti=class{constructor(e=!1,t=new N){this.isOverwritten=e,this.color=t}},Ti=class{constructor(e=!1,t=!1){this.isOverwritten=e,this.isCulling=t}},ct=class{update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getPixelsPerUnit(){return this._model==null?0:this._model.canvasinfo.PixelsPerUnit}getCanvasWidth(){return this._model==null?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return this._model==null?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){let e=this._model.parameters.count,t=this._savedParameters.getSize();for(let i=0;i<e;++i)i<t?this._savedParameters.set(i,this._parameterValues[i]):this._savedParameters.pushBack(this._parameterValues[i])}getMultiplyColor(e){return this.getOverwriteFlagForModelMultiplyColors()||this.getOverwriteFlagForDrawableMultiplyColors(e)?this._userMultiplyColors.at(e).color:this.getDrawableMultiplyColor(e)}getScreenColor(e){return this.getOverwriteFlagForModelScreenColors()||this.getOverwriteFlagForDrawableScreenColors(e)?this._userScreenColors.at(e).color:this.getDrawableScreenColor(e)}setMultiplyColorByTextureColor(e,t){this.setMultiplyColorByRGBA(e,t.r,t.g,t.b,t.a)}setMultiplyColorByRGBA(e,t,i,r,s=1){this._userMultiplyColors.at(e).color.r=t,this._userMultiplyColors.at(e).color.g=i,this._userMultiplyColors.at(e).color.b=r,this._userMultiplyColors.at(e).color.a=s}setScreenColorByTextureColor(e,t){this.setScreenColorByRGBA(e,t.r,t.g,t.b,t.a)}setScreenColorByRGBA(e,t,i,r,s=1){this._userScreenColors.at(e).color.r=t,this._userScreenColors.at(e).color.g=i,this._userScreenColors.at(e).color.b=r,this._userScreenColors.at(e).color.a=s}getPartMultiplyColor(e){return this._userPartMultiplyColors.at(e).color}getPartScreenColor(e){return this._userPartScreenColors.at(e).color}setPartColor(e,t,i,r,s,o,n){if(o.at(e).color.r=t,o.at(e).color.g=i,o.at(e).color.b=r,o.at(e).color.a=s,o.at(e).isOverwritten)for(let u=0;u<this._partChildDrawables.at(e).getSize();++u){let m=this._partChildDrawables.at(e).at(u);n.at(m).color.r=t,n.at(m).color.g=i,n.at(m).color.b=r,n.at(m).color.a=s}}setPartMultiplyColorByTextureColor(e,t){this.setPartMultiplyColorByRGBA(e,t.r,t.g,t.b,t.a)}setPartMultiplyColorByRGBA(e,t,i,r,s){this.setPartColor(e,t,i,r,s,this._userPartMultiplyColors,this._userMultiplyColors)}setPartScreenColorByTextureColor(e,t){this.setPartScreenColorByRGBA(e,t.r,t.g,t.b,t.a)}setPartScreenColorByRGBA(e,t,i,r,s){this.setPartColor(e,t,i,r,s,this._userPartScreenColors,this._userScreenColors)}getOverwriteFlagForModelMultiplyColors(){return this._isOverwrittenModelMultiplyColors}getOverwriteFlagForModelScreenColors(){return this._isOverwrittenModelScreenColors}setOverwriteFlagForModelMultiplyColors(e){this._isOverwrittenModelMultiplyColors=e}setOverwriteFlagForModelScreenColors(e){this._isOverwrittenModelScreenColors=e}getOverwriteFlagForDrawableMultiplyColors(e){return this._userMultiplyColors.at(e).isOverwritten}getOverwriteFlagForDrawableScreenColors(e){return this._userScreenColors.at(e).isOverwritten}setOverwriteFlagForDrawableMultiplyColors(e,t){this._userMultiplyColors.at(e).isOverwritten=t}setOverwriteFlagForDrawableScreenColors(e,t){this._userScreenColors.at(e).isOverwritten=t}getOverwriteColorForPartMultiplyColors(e){return this._userPartMultiplyColors.at(e).isOverwritten}getOverwriteColorForPartScreenColors(e){return this._userPartScreenColors.at(e).isOverwritten}setOverwriteColorForPartColors(e,t,i,r){i.at(e).isOverwritten=t;for(let s=0;s<this._partChildDrawables.at(e).getSize();++s){let o=this._partChildDrawables.at(e).at(s);r.at(o).isOverwritten=t,t&&(r.at(o).color.r=i.at(e).color.r,r.at(o).color.g=i.at(e).color.g,r.at(o).color.b=i.at(e).color.b,r.at(o).color.a=i.at(e).color.a)}}setOverwriteColorForPartMultiplyColors(e,t){this._userPartMultiplyColors.at(e).isOverwritten=t,this.setOverwriteColorForPartColors(e,t,this._userPartMultiplyColors,this._userMultiplyColors)}setOverwriteColorForPartScreenColors(e,t){this._userPartScreenColors.at(e).isOverwritten=t,this.setOverwriteColorForPartColors(e,t,this._userPartScreenColors,this._userScreenColors)}getDrawableCulling(e){if(this.getOverwriteFlagForModelCullings()||this.getOverwriteFlagForDrawableCullings(e))return this._userCullings.at(e).isCulling;let t=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(t[e])}setDrawableCulling(e,t){this._userCullings.at(e).isCulling=t}getOverwriteFlagForModelCullings(){return this._isOverwrittenCullings}setOverwriteFlagForModelCullings(e){this._isOverwrittenCullings=e}getOverwriteFlagForDrawableCullings(e){return this._userCullings.at(e).isOverwritten}setOverwriteFlagForDrawableCullings(e,t){this._userCullings.at(e).isOverwritten=t}getModelOapcity(){return this._modelOpacity}setModelOapcity(e){this._modelOpacity=e}getModel(){return this._model}getPartIndex(e){let t,i=this._model.parts.count;for(t=0;t<i;++t)if(e==this._partIds.at(t))return t;return this._notExistPartId.isExist(e)?this._notExistPartId.getValue(e):(t=i+this._notExistPartId.getSize(),this._notExistPartId.setValue(e,t),this._notExistPartOpacities.appendKey(t),t)}getPartId(e){let t=this._model.parts.ids[e];return v.getIdManager().getId(t)}getPartCount(){return this._model.parts.count}setPartOpacityByIndex(e,t){if(this._notExistPartOpacities.isExist(e)){this._notExistPartOpacities.setValue(e,t);return}z(0<=e&&e<this.getPartCount()),this._partOpacities[e]=t}setPartOpacityById(e,t){let i=this.getPartIndex(e);i<0||this.setPartOpacityByIndex(i,t)}getPartOpacityByIndex(e){return this._notExistPartOpacities.isExist(e)?this._notExistPartOpacities.getValue(e):(z(0<=e&&e<this.getPartCount()),this._partOpacities[e])}getPartOpacityById(e){let t=this.getPartIndex(e);return t<0?0:this.getPartOpacityByIndex(t)}getParameterIndex(e){let t,i=this._model.parameters.count;for(t=0;t<i;++t)if(e==this._parameterIds.at(t))return t;return this._notExistParameterId.isExist(e)?this._notExistParameterId.getValue(e):(t=this._model.parameters.count+this._notExistParameterId.getSize(),this._notExistParameterId.setValue(e,t),this._notExistParameterValues.appendKey(t),t)}getParameterCount(){return this._model.parameters.count}getParameterType(e){return this._model.parameters.types[e]}getParameterMaximumValue(e){return this._model.parameters.maximumValues[e]}getParameterMinimumValue(e){return this._model.parameters.minimumValues[e]}getParameterDefaultValue(e){return this._model.parameters.defaultValues[e]}getParameterId(e){return v.getIdManager().getId(this._model.parameters.ids[e])}getParameterValueByIndex(e){return this._notExistParameterValues.isExist(e)?this._notExistParameterValues.getValue(e):(z(0<=e&&e<this.getParameterCount()),this._parameterValues[e])}getParameterValueById(e){let t=this.getParameterIndex(e);return this.getParameterValueByIndex(t)}setParameterValueByIndex(e,t,i=1){if(this._notExistParameterValues.isExist(e)){this._notExistParameterValues.setValue(e,i==1?t:this._notExistParameterValues.getValue(e)*(1-i)+t*i);return}z(0<=e&&e<this.getParameterCount()),this._model.parameters.maximumValues[e]<t&&(t=this._model.parameters.maximumValues[e]),this._model.parameters.minimumValues[e]>t&&(t=this._model.parameters.minimumValues[e]),this._parameterValues[e]=i==1?t:this._parameterValues[e]=this._parameterValues[e]*(1-i)+t*i}setParameterValueById(e,t,i=1){let r=this.getParameterIndex(e);this.setParameterValueByIndex(r,t,i)}addParameterValueByIndex(e,t,i=1){this.setParameterValueByIndex(e,this.getParameterValueByIndex(e)+t*i)}addParameterValueById(e,t,i=1){let r=this.getParameterIndex(e);this.addParameterValueByIndex(r,t,i)}multiplyParameterValueById(e,t,i=1){let r=this.getParameterIndex(e);this.multiplyParameterValueByIndex(r,t,i)}multiplyParameterValueByIndex(e,t,i=1){this.setParameterValueByIndex(e,this.getParameterValueByIndex(e)*(1+(t-1)*i))}getDrawableIndex(e){let t=this._model.drawables.count;for(let i=0;i<t;++i)if(this._drawableIds.at(i)==e)return i;return-1}getDrawableCount(){return this._model.drawables.count}getDrawableId(e){let t=this._model.drawables.ids;return v.getIdManager().getId(t[e])}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(e){return this.getDrawableTextureIndex(e)}getDrawableTextureIndex(e){return this._model.drawables.textureIndices[e]}getDrawableDynamicFlagVertexPositionsDidChange(e){let t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(t[e])}getDrawableVertexIndexCount(e){return this._model.drawables.indexCounts[e]}getDrawableVertexCount(e){return this._model.drawables.vertexCounts[e]}getDrawableVertices(e){return this.getDrawableVertexPositions(e)}getDrawableVertexIndices(e){return this._model.drawables.indices[e]}getDrawableVertexPositions(e){return this._model.drawables.vertexPositions[e]}getDrawableVertexUvs(e){return this._model.drawables.vertexUvs[e]}getDrawableOpacity(e){return this._model.drawables.opacities[e]}getDrawableMultiplyColor(e){let t=this._model.drawables.multiplyColors,i=e*4,r=new N;return r.r=t[i],r.g=t[i+1],r.b=t[i+2],r.a=t[i+3],r}getDrawableScreenColor(e){let t=this._model.drawables.screenColors,i=e*4,r=new N;return r.r=t[i],r.g=t[i+1],r.b=t[i+2],r.a=t[i+3],r}getDrawableParentPartIndex(e){return this._model.drawables.parentPartIndices[e]}getDrawableBlendMode(e){let t=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(t[e])?1:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(t[e])?2:0}getDrawableInvertedMaskBit(e){let t=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(t[e])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let e=0;e<this._model.drawables.count;++e)if(!(this._model.drawables.maskCounts[e]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(e){let t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(t[e])}getDrawableDynamicFlagVisibilityDidChange(e){let t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(t[e])}getDrawableDynamicFlagOpacityDidChange(e){let t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(t[e])}getDrawableDynamicFlagRenderOrderDidChange(e){let t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(t[e])}getDrawableDynamicFlagBlendColorDidChange(e){let t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasBlendColorDidChangeBit(t[e])}loadParameters(){let e=this._model.parameters.count,t=this._savedParameters.getSize();e>t&&(e=t);for(let i=0;i<e;++i)this._parameterValues[i]=this._savedParameters.at(i)}initialize(){z(this._model),this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{let t=this._model.parameters.ids,i=this._model.parameters.count;this._parameterIds.prepareCapacity(i);for(let r=0;r<i;++r)this._parameterIds.pushBack(v.getIdManager().getId(t[r]))}let e=this._model.parts.count;{let t=this._model.parts.ids;this._partIds.prepareCapacity(e);for(let i=0;i<e;++i)this._partIds.pushBack(v.getIdManager().getId(t[i]));this._userPartMultiplyColors.prepareCapacity(e),this._userPartScreenColors.prepareCapacity(e),this._partChildDrawables.prepareCapacity(e)}{let t=this._model.drawables.ids,i=this._model.drawables.count;this._userMultiplyColors.prepareCapacity(i),this._userScreenColors.prepareCapacity(i),this._userCullings.prepareCapacity(i);let r=new Ti(!1,!1);for(let s=0;s<e;++s){let o=new N(1,1,1,1),n=new N(0,0,0,1),u=new ti(!1,o),m=new ti(!1,n);this._userPartMultiplyColors.pushBack(u),this._userPartScreenColors.pushBack(m),this._partChildDrawables.pushBack(new _),this._partChildDrawables.at(s).prepareCapacity(i)}for(let s=0;s<i;++s){let o=new N(1,1,1,1),n=new N(0,0,0,1),u=new ei(!1,o),m=new ei(!1,n);this._drawableIds.pushBack(v.getIdManager().getId(t[s])),this._userMultiplyColors.pushBack(u),this._userScreenColors.pushBack(m),this._userCullings.pushBack(r);let l=this.getDrawableParentPartIndex(s);l>=0&&this._partChildDrawables.at(l).pushBack(s)}}}constructor(e){this._model=e,this._parameterValues=null,this._parameterMaximumValues=null,this._parameterMinimumValues=null,this._partOpacities=null,this._savedParameters=new _,this._parameterIds=new _,this._drawableIds=new _,this._partIds=new _,this._isOverwrittenModelMultiplyColors=!1,this._isOverwrittenModelScreenColors=!1,this._isOverwrittenCullings=!1,this._modelOpacity=1,this._userMultiplyColors=new _,this._userScreenColors=new _,this._userCullings=new _,this._userPartMultiplyColors=new _,this._userPartScreenColors=new _,this._partChildDrawables=new _,this._notExistPartId=new k,this._notExistParameterId=new k,this._notExistParameterValues=new k,this._notExistPartOpacities=new k}release(){this._model.release(),this._model=null}},vn;(e=>e.CubismModel=ct)(vn||={});var fe=class a{static create(e,t){let i=null;if(t&&!this.hasMocConsistency(e))return B("Inconsistent MOC3."),i;let r=Live2DCubismCore.Moc.fromArrayBuffer(e);return r&&(i=new a(r),i._mocVersion=Live2DCubismCore.Version.csmGetMocVersion(r,e)),i}static delete(e){e._moc._release(),e._moc=null,e=null}createModel(){let e=null,t=Live2DCubismCore.Model.fromMoc(this._moc);return t&&(e=new ct(t),e.initialize(),++this._modelCount),e}deleteModel(e){e!=null&&(e.release(),e=null,--this._modelCount)}constructor(e){this._moc=e,this._modelCount=0,this._mocVersion=0}release(){z(this._modelCount==0),this._moc._release(),this._moc=null}getLatestMocVersion(){return Live2DCubismCore.Version.csmGetLatestMocVersion()}getMocVersion(){return this._mocVersion}static hasMocConsistency(e){return Live2DCubismCore.Moc.prototype.hasMocConsistency(e)===1}},In;(e=>e.CubismMoc=fe)(In||={});var vr="Meta",Tn="UserDataCount",En="TotalUserDataSize",Ei="UserData",wn="Target",Fn="Id",An="Value",ht=class{constructor(e,t){this._json=L.create(e,t)}release(){L.delete(this._json)}getUserDataCount(){return this._json.getRoot().getValueByString(vr).getValueByString(Tn).toInt()}getTotalUserDataSize(){return this._json.getRoot().getValueByString(vr).getValueByString(En).toInt()}getUserDataTargetType(e){return this._json.getRoot().getValueByString(Ei).getValueByIndex(e).getValueByString(wn).getRawString()}getUserDataId(e){return v.getIdManager().getId(this._json.getRoot().getValueByString(Ei).getValueByIndex(e).getValueByString(Fn).getRawString())}getUserDataValue(e){return this._json.getRoot().getValueByString(Ei).getValueByIndex(e).getValueByString(An).getRawString()}},Rn;(e=>e.CubismModelUserDataJson=ht)(Rn||={});var Dn="ArtMesh",Tt=class{},Ae=class a{static create(e,t){let i=new a;return i.parseUserData(e,t),i}static delete(e){e!=null&&(e.release(),e=null)}getArtMeshUserDatas(){return this._artMeshUserDataNode}parseUserData(e,t){let i=new ht(e,t);if(!i){i.release(),i=void 0;return}let r=v.getIdManager().getId(Dn),s=i.getUserDataCount();for(let o=0;o<s;o++){let n=new Tt;n.targetId=i.getUserDataId(o),n.targetType=v.getIdManager().getId(i.getUserDataTargetType(o)),n.value=new D(i.getUserDataValue(o)),this._userDataNodes.pushBack(n),n.targetType==r&&this._artMeshUserDataNode.pushBack(n)}i.release(),i=void 0}constructor(){this._userDataNodes=new _,this._artMeshUserDataNode=new _}release(){for(let e=0;e<this._userDataNodes.getSize();++e)this._userDataNodes.set(e,null);this._userDataNodes=null}},On;(t=>(t.CubismModelUserData=Ae,t.CubismModelUserDataNode=Tt))(On||={});var pt=class a{isInitialized(){return this._initialized}setInitialized(e){this._initialized=e}isUpdating(){return this._updating}setUpdating(e){this._updating=e}setDragging(e,t){this._dragManager.set(e,t)}setAcceleration(e,t,i){this._accelerationX=e,this._accelerationY=t,this._accelerationZ=i}getModelMatrix(){return this._modelMatrix}setOpacity(e){this._opacity=e}getOpacity(){return this._opacity}loadModel(e,t=!1){if(this._moc=fe.create(e,t),this._moc==null){B("Failed to CubismMoc.create().");return}if(this._model=this._moc.createModel(),this._model==null){B("Failed to CreateModel().");return}this._model.saveParameters(),this._modelMatrix=new Ge(this._model.getCanvasWidth(),this._model.getCanvasHeight())}loadMotion(e,t,i,r){return e==null||t==0?(B("Failed to loadMotion()."),null):Ze.create(e,t,r)}loadExpression(e,t,i){return e==null||t==0?(B("Failed to loadExpression()."),null):Z.create(e,t)}loadPose(e,t){if(e==null||t==0){B("Failed to loadPose().");return}this._pose=Ve.create(e,t)}loadUserData(e,t){if(e==null||t==0){B("Failed to loadUserData().");return}this._modelUserData=Ae.create(e,t)}loadPhysics(e,t){if(e==null||t==0){B("Failed to loadPhysics().");return}this._physics=Ee.create(e,t)}isHit(e,t,i){let r=this._model.getDrawableIndex(e);if(r<0)return!1;let s=this._model.getDrawableVertexCount(r),o=this._model.getDrawableVertices(r),n=o[0],u=o[0],m=o[1],l=o[1];for(let c=1;c<s;++c){let h=o[Q.vertexOffset+c*Q.vertexStep],b=o[Q.vertexOffset+c*Q.vertexStep+1];h<n&&(n=h),h>u&&(u=h),b<m&&(m=b),b>l&&(l=b)}let p=this._modelMatrix.invertTransformX(t),d=this._modelMatrix.invertTransformY(i);return n<=p&&p<=u&&m<=d&&d<=l}getModel(){return this._model}getRenderer(){return this._renderer}createRenderer(e=2){this._renderer&&this.deleteRenderer(),this._renderer=new Fe,this._renderer.initialize(this._model,e)}deleteRenderer(){this._renderer!=null&&(this._renderer.release(),this._renderer=null)}motionEventFired(e){U("{0}",e.s)}static cubismDefaultMotionEventCallback(e,t,i){let r=i;r?.motionEventFired(t)}constructor(){this._moc=null,this._model=null,this._motionManager=null,this._expressionManager=null,this._eyeBlink=null,this._breath=null,this._modelMatrix=null,this._pose=null,this._dragManager=null,this._physics=null,this._modelUserData=null,this._initialized=!1,this._updating=!1,this._opacity=1,this._lipsync=!0,this._lastLipSyncValue=0,this._dragX=0,this._dragY=0,this._accelerationX=0,this._accelerationY=0,this._accelerationZ=0,this._mocConsistency=!1,this._debugMode=!1,this._renderer=null,this._motionManager=new et,this._motionManager.setEventCallback(a.cubismDefaultMotionEventCallback,this),this._expressionManager=new Ye,this._dragManager=new He}release(){this._motionManager!=null&&(this._motionManager.release(),this._motionManager=null),this._expressionManager!=null&&(this._expressionManager.release(),this._expressionManager=null),this._moc!=null&&(this._moc.deleteModel(this._model),this._moc.release(),this._moc=null),this._modelMatrix=null,Ve.delete(this._pose),de.delete(this._eyeBlink),ge.delete(this._breath),this._dragManager=null,Ee.delete(this._physics),Ae.delete(this._modelUserData),this.deleteRenderer()}},kn;(e=>e.CubismUserModel=pt)(kn||={});var E=class{static loadFileAsBytes(e,t){fetch(e).then(i=>i.arrayBuffer()).then(i=>t(i,i.byteLength))}static getDeltaTime(){return this.s_deltaTime}static updateTime(){this.s_currentFrame=Date.now(),this.s_deltaTime=(this.s_currentFrame-this.s_lastFrame)/1e3,this.s_lastFrame=this.s_currentFrame}static printMessage(e){console.log(e)}static{this.lastUpdate=Date.now()}static{this.s_currentFrame=0}static{this.s_lastFrame=0}static{this.s_deltaTime=0}};var gt=null,ii=class a{constructor(){this._loadFiletoBytes=(e,t)=>{this._byteReader._fileByte=e,this._byteReader._fileDataView=new DataView(this._byteReader._fileByte),this._byteReader._fileSize=t};this._pcmData=null,this._userTimeSeconds=0,this._lastRms=0,this._sampleOffset=0,this._wavFileInfo=new wi,this._byteReader=new Fi}static getInstance(){return gt==null&&(gt=new a),gt}static releaseInstance(){gt!=null&&(gt=void 0),gt=null}update(e){let t,i;if(this._pcmData==null||this._sampleOffset>=this._wavFileInfo._samplesPerChannel)return this._lastRms=0,!1;this._userTimeSeconds+=e,t=Math.floor(this._userTimeSeconds*this._wavFileInfo._samplingRate),t>this._wavFileInfo._samplesPerChannel&&(t=this._wavFileInfo._samplesPerChannel),i=0;for(let r=0;r<this._wavFileInfo._numberOfChannels;r++)for(let s=this._sampleOffset;s<t;s++){let o=this._pcmData[r][s];i+=o*o}return i=Math.sqrt(i/(this._wavFileInfo._numberOfChannels*(t-this._sampleOffset))),this._lastRms=i,this._sampleOffset=t,!0}start(e){this._sampleOffset=0,this._userTimeSeconds=0,this._lastRms=0,this.loadWavFile(e)}getRms(){return this._lastRms}loadWavFile(e){return new Promise(t=>{let i=!1;this._pcmData!=null&&this.releasePcmData();let r=async()=>fetch(e).then(o=>o.arrayBuffer()),s=(async()=>{if(this._byteReader._fileByte=await r(),this._byteReader._fileDataView=new DataView(this._byteReader._fileByte),this._byteReader._fileSize=this._byteReader._fileByte.byteLength,this._byteReader._readOffset=0,this._byteReader._fileByte==null||this._byteReader._fileSize<4){t(!1);return}this._wavFileInfo._fileName=e;try{if(!this._byteReader.getCheckSignature("RIFF"))throw i=!1,new Error('Cannot find Signeture "RIFF".');if(this._byteReader.get32LittleEndian(),!this._byteReader.getCheckSignature("WAVE"))throw i=!1,new Error('Cannot find Signeture "WAVE".');if(!this._byteReader.getCheckSignature("fmt "))throw i=!1,new Error('Cannot find Signeture "fmt".');let o=this._byteReader.get32LittleEndian();if(this._byteReader.get16LittleEndian()!=1)throw i=!1,new Error("File is not linear PCM.");for(this._wavFileInfo._numberOfChannels=this._byteReader.get16LittleEndian(),this._wavFileInfo._samplingRate=this._byteReader.get32LittleEndian(),this._byteReader.get32LittleEndian(),this._byteReader.get16LittleEndian(),this._wavFileInfo._bitsPerSample=this._byteReader.get16LittleEndian(),o>16&&(this._byteReader._readOffset+=o-16);!this._byteReader.getCheckSignature("data")&&this._byteReader._readOffset<this._byteReader._fileSize;)this._byteReader._readOffset+=this._byteReader.get32LittleEndian()+4;if(this._byteReader._readOffset>=this._byteReader._fileSize)throw i=!1,new Error('Cannot find "data" Chunk.');{let n=this._byteReader.get32LittleEndian();this._wavFileInfo._samplesPerChannel=n*8/(this._wavFileInfo._bitsPerSample*this._wavFileInfo._numberOfChannels)}this._pcmData=new Array(this._wavFileInfo._numberOfChannels);for(let n=0;n<this._wavFileInfo._numberOfChannels;n++)this._pcmData[n]=new Float32Array(this._wavFileInfo._samplesPerChannel);for(let n=0;n<this._wavFileInfo._samplesPerChannel;n++)for(let u=0;u<this._wavFileInfo._numberOfChannels;u++)this._pcmData[u][n]=this.getPcmSample();i=!0,t(i)}catch(o){console.log(o)}})().then(()=>{t(i)})})}getPcmSample(){let e;switch(this._wavFileInfo._bitsPerSample){case 8:e=this._byteReader.get8()-128,e<<=24;break;case 16:e=this._byteReader.get16LittleEndian()<<16;break;case 24:e=this._byteReader.get24LittleEndian()<<8;break;default:e=0;break}return e/2147483647}getPcmDataChannel(e){return!this._pcmData||!(e<this._pcmData.length)?null:Float32Array.from(this._pcmData[e])}getWavSamplingRate(){return!this._wavFileInfo||this._wavFileInfo._samplingRate<1?null:this._wavFileInfo._samplingRate}releasePcmData(){for(let e=0;e<this._wavFileInfo._numberOfChannels;e++)delete this._pcmData[e];delete this._pcmData,this._pcmData=null}},wi=class{constructor(){this._fileName="",this._numberOfChannels=0,this._bitsPerSample=0,this._samplingRate=0,this._samplesPerChannel=0}},Fi=class{constructor(){this._fileByte=null,this._fileDataView=null,this._fileSize=0,this._readOffset=0}get8(){let e=this._fileDataView.getUint8(this._readOffset);return this._readOffset++,e}get16LittleEndian(){let e=this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=2,e}get24LittleEndian(){let e=this._fileDataView.getUint8(this._readOffset+2)<<16|this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=3,e}get32LittleEndian(){let e=this._fileDataView.getUint8(this._readOffset+3)<<24|this._fileDataView.getUint8(this._readOffset+2)<<16|this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=4,e}getCheckSignature(e){let t=new Uint8Array(4),i=new TextEncoder().encode(e);if(e.length!=4)return!1;for(let r=0;r<4;r++)t[r]=this.get8();return t[0]==i[0]&&t[1]==i[1]&&t[2]==i[2]&&t[3]==i[3]}};var Et=class extends pt{loadAssets(e,t){this._modelHomeDir=e,fetch(`${this._modelHomeDir}${t}`).then(i=>i.arrayBuffer()).then(i=>{let r=new ze(i,i.byteLength);this._state=1,this.setupModel(r)}).catch(i=>{B(`Failed to load file ${this._modelHomeDir}${t}`)}),fetch(`${this._modelHomeDir}config.json`).then(i=>i.json()).then(i=>{this._scale=i.scale?i.scale:1,this._translateX=i.translate.x?i.translate.x:0,this._translateY=i.translate.y?i.translate.y:0}).catch(i=>{this._scale=1,this._translateX=0,this._translateY=0})}setupModel(e){if(this._updating=!0,this._initialized=!1,this._modelSetting=e,this._modelSetting.getModelFileName()!=""){let d=this._modelSetting.getModelFileName();fetch(`${this._modelHomeDir}${d}`).then(c=>{if(c.ok)return c.arrayBuffer();if(c.status>=400)return B(`Failed to load file ${this._modelHomeDir}${d}`),new ArrayBuffer(0)}).then(c=>{this.loadModel(c,this._mocConsistency),this._state=3,t()}),this._state=2}else E.printMessage("Model data does not exist.");let t=()=>{if(this._modelSetting.getExpressionCount()>0){let d=this._modelSetting.getExpressionCount();for(let c=0;c<d;c++){let h=this._modelSetting.getExpressionName(c),b=this._modelSetting.getExpressionFileName(c);fetch(`${this._modelHomeDir}${b}`).then(g=>{if(g.ok)return g.arrayBuffer();if(g.status>=400)return B(`Failed to load file ${this._modelHomeDir}${b}`),new ArrayBuffer(0)}).then(g=>{let y=this.loadExpression(g,g.byteLength,h);this._expressions.getValue(h)!=null&&(Y.delete(this._expressions.getValue(h)),this._expressions.setValue(h,null)),this._expressions.setValue(h,y),this._expressionCount++,this._expressionCount>=d&&(this._state=5,i())})}this._state=4}else this._state=5,i()},i=()=>{if(this._modelSetting.getPhysicsFileName()!=""){let d=this._modelSetting.getPhysicsFileName();fetch(`${this._modelHomeDir}${d}`).then(c=>{if(c.ok)return c.arrayBuffer();if(c.status>=400)return B(`Failed to load file ${this._modelHomeDir}${d}`),new ArrayBuffer(0)}).then(c=>{this.loadPhysics(c,c.byteLength),this._state=7,r()}),this._state=6}else this._state=7,r()},r=()=>{if(this._modelSetting.getPoseFileName()!=""){let d=this._modelSetting.getPoseFileName();fetch(`${this._modelHomeDir}${d}`).then(c=>{if(c.ok)return c.arrayBuffer();if(c.status>=400)return B(`Failed to load file ${this._modelHomeDir}${d}`),new ArrayBuffer(0)}).then(c=>{this.loadPose(c,c.byteLength),this._state=9,s()}),this._state=8}else this._state=9,s()},s=()=>{this._modelSetting.getEyeBlinkParameterCount()>0&&(this._eyeBlink=de.create(this._modelSetting),this._state=10),o()},o=()=>{this._breath=ge.create();let d=new _;d.pushBack(new re(this._idParamAngleX,0,15,6.5345,.5)),d.pushBack(new re(this._idParamAngleY,0,8,3.5345,.5)),d.pushBack(new re(this._idParamAngleZ,0,10,5.5345,.5)),d.pushBack(new re(this._idParamBodyAngleX,0,4,15.5345,.5)),d.pushBack(new re(v.getIdManager().getId(x.ParamBreath),.5,.5,3.2345,1)),this._breath.setParameters(d),this._state=11,n()},n=()=>{if(this._modelSetting.getUserDataFile()!=""){let d=this._modelSetting.getUserDataFile();fetch(`${this._modelHomeDir}${d}`).then(c=>{if(c.ok)return c.arrayBuffer();if(c.status>=400)return B(`Failed to load file ${this._modelHomeDir}${d}`),new ArrayBuffer(0)}).then(c=>{this.loadUserData(c,c.byteLength),this._state=13,u()}),this._state=12}else this._state=13,u()},u=()=>{let d=this._modelSetting.getEyeBlinkParameterCount();for(let c=0;c<d;++c)this._eyeBlinkIds.pushBack(this._modelSetting.getEyeBlinkParameterId(c));this._state=14,m()},m=()=>{let d=this._modelSetting.getLipSyncParameterCount();for(let c=0;c<d;++c)this._lipSyncIds.pushBack(this._modelSetting.getLipSyncParameterId(c));this._state=15,l()},l=()=>{let d=new k;if(this._modelSetting==null||this._modelMatrix==null){B("Failed to setupLayout().");return}this._modelSetting.getLayoutMap(d),this._modelMatrix.setupFromLayout(d),this._state=16,p()},p=()=>{this._state=17,this._model.saveParameters(),this._allMotionCount=0,this._motionCount=0;let d=[],c=this._modelSetting.getMotionGroupCount();for(let h=0;h<c;h++)d[h]=this._modelSetting.getMotionGroupName(h),this._allMotionCount+=this._modelSetting.getMotionCount(d[h]);for(let h=0;h<c;h++)this.preLoadMotionGroup(d[h]);c==0&&(this._state=20,this._motionManager.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),this.getRenderer().startUp(f))}}setupTextures(){if(this._state==20){let t=this._modelSetting.getTextureCount();for(let i=0;i<t;i++){if(this._modelSetting.getTextureFileName(i)==""){console.log("getTextureFileName null");continue}let r=this._modelSetting.getTextureFileName(i);r=this._modelHomeDir+r;let s=o=>{this.getRenderer().bindTexture(i,o.id),this._textureCount++,this._textureCount>=t&&(this._state=22)};w.getInstance().getTextureManager().createTextureFromPngFile(r,!0,s),this.getRenderer().setIsPremultipliedAlpha(!0)}this._state=21}}reloadRenderer(){this.deleteRenderer(),this.createRenderer(),this.setupTextures()}update(){if(this._state!=22)return;let e=E.getDeltaTime();this._userTimeSeconds+=e,this._dragManager.update(e),this._dragX=this._dragManager.getX(),this._dragY=this._dragManager.getY();let t=!1;if(this._model.loadParameters(),this._motionManager.isFinished()?this.startRandomMotion(Wi,qi):t=this._motionManager.updateMotion(this._model,e),this._model.saveParameters(),t||this._eyeBlink!=null&&this._eyeBlink.updateParameters(this._model,e),this._expressionManager!=null&&this._expressionManager.updateMotion(this._model,e),this._model.addParameterValueById(this._idParamAngleX,this._dragX*30),this._model.addParameterValueById(this._idParamAngleY,this._dragY*30),this._model.addParameterValueById(this._idParamAngleZ,this._dragX*this._dragY*-30),this._model.addParameterValueById(this._idParamBodyAngleX,this._dragX*10),this._model.addParameterValueById(this._idParamEyeBallX,this._dragX),this._model.addParameterValueById(this._idParamEyeBallY,this._dragY),this._breath!=null&&this._breath.updateParameters(this._model,e),this._physics!=null&&this._physics.evaluate(this._model,e),this._lipsync){let i=0;this._wavFileHandler.update(e),i=this._wavFileHandler.getRms();for(let r=0;r<this._lipSyncIds.getSize();++r)this._model.addParameterValueById(this._lipSyncIds.at(r),i,.8)}this._pose!=null&&this._pose.updateParameters(this._model,e),this._model.update()}startMotion(e,t,i,r){if(i==mi)this._motionManager.setReservePriority(i);else if(!this._motionManager.reserveMotion(i))return this._debugMode&&E.printMessage("[APP]can't start motion."),We;let s=this._modelSetting.getMotionFileName(e,t),o=`${e}_${t}`,n=this._motions.getValue(o),u=!1;n==null?fetch(`${this._modelHomeDir}${s}`).then(l=>{if(l.ok)return l.arrayBuffer();if(l.status>=400)return B(`Failed to load file ${this._modelHomeDir}${s}`),new ArrayBuffer(0)}).then(l=>{if(n=this.loadMotion(l,l.byteLength,null,r),n==null)return;let p=this._modelSetting.getMotionFadeInTimeValue(e,t);p>=0&&n.setFadeInTime(p),p=this._modelSetting.getMotionFadeOutTimeValue(e,t),p>=0&&n.setFadeOutTime(p),n.setEffectIds(this._eyeBlinkIds,this._lipSyncIds),u=!0}):n.setFinishedMotionHandler(r);let m=this._modelSetting.getMotionSoundFileName(e,t);if(m.localeCompare("")!=0){let l=m;l=this._modelHomeDir+l,this._wavFileHandler.start(l)}return this._debugMode&&E.printMessage(`[APP]start motion: [${e}_${t}`),this._motionManager.startMotionPriority(n,u,i)}startRandomMotion(e,t,i){if(this._modelSetting.getMotionCount(e)==0)return We;let r=Math.floor(Math.random()*this._modelSetting.getMotionCount(e));return this.startMotion(e,r,t,i)}setExpression(e){let t=this._expressions.getValue(e);this._debugMode&&E.printMessage(`[APP]expression: [${e}]`),t!=null?this._expressionManager.startMotionPriority(t,!1,mi):this._debugMode&&E.printMessage(`[APP]expression[${e}] is null`)}setRandomExpression(){if(this._expressions.getSize()==0)return;let e=Math.floor(Math.random()*this._expressions.getSize());for(let t=0;t<this._expressions.getSize();t++)if(t==e){let i=this._expressions._keyValues[t].first;this.setExpression(i);return}}motionEventFired(e){U("{0} is fired on LAppModel!!",e.s)}hitTest(e,t,i){if(this._opacity<1)return!1;let r=this._modelSetting.getHitAreasCount();for(let s=0;s<r;s++)if(this._modelSetting.getHitAreaName(s)==e){let o=this._modelSetting.getHitAreaId(s);return this.isHit(o,t,i)}return!1}preLoadMotionGroup(e){for(let t=0;t<this._modelSetting.getMotionCount(e);t++){let i=this._modelSetting.getMotionFileName(e,t),r=`${e}_${t}`;this._debugMode&&E.printMessage(`[APP]load motion: ${i} => [${r}]`),fetch(`${this._modelHomeDir}${i}`).then(s=>{if(s.ok)return s.arrayBuffer();if(s.status>=400)return B(`Failed to load file ${this._modelHomeDir}${i}`),new ArrayBuffer(0)}).then(s=>{let o=this.loadMotion(s,s.byteLength,r);if(o!=null){let n=this._modelSetting.getMotionFadeInTimeValue(e,t);n>=0&&o.setFadeInTime(n),n=this._modelSetting.getMotionFadeOutTimeValue(e,t),n>=0&&o.setFadeOutTime(n),o.setEffectIds(this._eyeBlinkIds,this._lipSyncIds),this._motions.getValue(r)!=null&&Y.delete(this._motions.getValue(r)),this._motions.setValue(r,o),this._motionCount++,this._motionCount>=this._allMotionCount&&(this._state=20,this._motionManager.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),this.getRenderer().startUp(f))}else this._allMotionCount--})}}releaseMotions(){this._motions.clear()}releaseExpressions(){this._expressions.clear()}doDraw(){if(this._model==null)return;let e=[0,0,F.width,F.height];this.getRenderer().setRenderState(ri,e),this.getRenderer().drawModel()}draw(e){this._model!=null&&this._state==22&&(e.multiplyByMatrix(this._modelMatrix),this.getRenderer().setMvpMatrix(e),this.doDraw())}async hasMocConsistencyFromFile(){if(z(this._modelSetting.getModelFileName().localeCompare("")),this._modelSetting.getModelFileName()!=""){let e=this._modelSetting.getModelFileName(),i=await(await fetch(`${this._modelHomeDir}${e}`)).arrayBuffer();return this._consistency=fe.hasMocConsistency(i),this._consistency?U("Consistent MOC3."):U("Inconsistent MOC3."),this._consistency}else E.printMessage("Model data does not exist.")}constructor(){super(),this._modelSetting=null,this._modelHomeDir=null,this._userTimeSeconds=0,this._eyeBlinkIds=new _,this._lipSyncIds=new _,this._motions=new k,this._expressions=new k,this._hitArea=new _,this._userArea=new _,this._idParamAngleX=v.getIdManager().getId(x.ParamAngleX),this._idParamAngleY=v.getIdManager().getId(x.ParamAngleY),this._idParamAngleZ=v.getIdManager().getId(x.ParamAngleZ),this._idParamEyeBallX=v.getIdManager().getId(x.ParamEyeBallX),this._idParamEyeBallY=v.getIdManager().getId(x.ParamEyeBallY),this._idParamBodyAngleX=v.getIdManager().getId(x.ParamBodyAngleX),Ji&&(this._mocConsistency=!0),this._state=0,this._expressionCount=0,this._textureCount=0,this._motionCount=0,this._allMotionCount=0,this._wavFileHandler=new ii,this._consistency=!1}};var dt=null,J=class a{constructor(){this._finishedMotion=e=>{E.printMessage("Motion Finished:"),console.log(e)};this._viewMatrix=new A,this._models=new _,this._sceneIndex=0}static getInstance(){return dt==null&&(dt=new a),dt}static releaseInstance(){dt!=null&&(dt=void 0),dt=null}getModel(e){return e<this._models.getSize()?this._models.at(e):null}releaseAllModel(){for(let e=0;e<this._models.getSize();e++)this._models.at(e).release(),this._models.set(e,null);this._models.clear()}onDrag(e,t){for(let i=0;i<this._models.getSize();i++){let r=this.getModel(i);r&&r.setDragging(e,t)}}onTap(e,t){ci&&E.printMessage(`[APP]tap point: {x: ${e.toFixed(2)} y: ${t.toFixed(2)}}`);for(let i=0;i<this._models.getSize();i++)this._models.at(i).startRandomMotion(Yi,ji,this._finishedMotion)}onUpdate(){let{width:e,height:t}=F,i=this._models.getSize();for(let r=0;r<i;++r){let s=new A,o=this.getModel(r);o.getModel()&&(o.getModel().getCanvasWidth()>1&&e<t?(o.getModelMatrix().setWidth(2),s.scale(1,e/t)):s.scale(t/e,1),s.scale(o._scale*s.getScaleX(),o._scale*s.getScaleY()),s.translate(o._translateX,o._translateY),this._viewMatrix!=null&&s.multiplyByMatrix(this._viewMatrix)),o.update(),o.draw(s)}}nextScene(){let e=(this._sceneIndex+1)%Xi;this.changeScene(e)}changeScene(e){this._sceneIndex=e,ci&&E.printMessage(`[APP]model index: ${this._sceneIndex}`);let t=Ot[e],i=Dt+t+"/",r=Ot[e];r+=".model3.json",this.releaseAllModel(),this._models.pushBack(new Et),this._models.at(0).loadAssets(i,r)}setViewMatrix(e){for(let t=0;t<16;t++)this._viewMatrix.getArray()[t]=e.getArray()[t]}loadModel(e){let i=e.substring(e.lastIndexOf("/",e.lastIndexOf("/")-1)+1,e.length-1)+".model3.json";this.releaseAllModel(),this._models.pushBack(new Et),this._models.at(0).loadAssets(e,i)}randomExpression(){for(let e=0;e<this._models.getSize();e++)this._models.at(e).setRandomExpression()}};var si=class{constructor(){this._textures=new _}release(){for(let e=this._textures.begin();e.notEqual(this._textures.end());e.preIncrement())f.deleteTexture(e.ptr().id);this._textures=null}createTextureFromPngFile(e,t,i){for(let s=this._textures.begin();s.notEqual(this._textures.end());s.preIncrement())if(s.ptr().fileName==e&&s.ptr().usePremultply==t){s.ptr().img=new Image,s.ptr().img.addEventListener("load",()=>i(s.ptr()),{passive:!0}),s.ptr().img.src=e;return}let r=new Image;r.crossOrigin="anonymous",r.addEventListener("load",()=>{let s=f.createTexture();f.bindTexture(f.TEXTURE_2D,s),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR_MIPMAP_LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),t&&f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,r),f.generateMipmap(f.TEXTURE_2D),f.bindTexture(f.TEXTURE_2D,null);let o=new Ai;o!=null&&(o.fileName=e,o.width=r.width,o.height=r.height,o.id=s,o.img=r,o.usePremultply=t,this._textures.pushBack(o)),i(o)},{passive:!0}),r.src=e}releaseTextures(){for(let e=0;e<this._textures.getSize();e++)this._textures.set(e,null);this._textures.clear()}releaseTextureByTexture(e){for(let t=0;t<this._textures.getSize();t++)if(this._textures.at(t).id==e){this._textures.set(t,null),this._textures.remove(t);break}}releaseTextureByFilePath(e){for(let t=0;t<this._textures.getSize();t++)if(this._textures.at(t).fileName==e){this._textures.set(t,null),this._textures.remove(t);break}}},Ai=class{constructor(){this.id=null;this.width=0;this.height=0}};var bt=class extends A{constructor(){super(),this._screenLeft=0,this._screenRight=0,this._screenTop=0,this._screenBottom=0,this._maxLeft=0,this._maxRight=0,this._maxTop=0,this._maxBottom=0,this._maxScale=0,this._minScale=0}adjustTranslate(e,t){this._tr[0]*this._maxLeft+(this._tr[12]+e)>this._screenLeft&&(e=this._screenLeft-this._tr[0]*this._maxLeft-this._tr[12]),this._tr[0]*this._maxRight+(this._tr[12]+e)<this._screenRight&&(e=this._screenRight-this._tr[0]*this._maxRight-this._tr[12]),this._tr[5]*this._maxTop+(this._tr[13]+t)<this._screenTop&&(t=this._screenTop-this._tr[5]*this._maxTop-this._tr[13]),this._tr[5]*this._maxBottom+(this._tr[13]+t)>this._screenBottom&&(t=this._screenBottom-this._tr[5]*this._maxBottom-this._tr[13]);let i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,e,t,0,1]);A.multiply(i,this._tr,this._tr)}adjustScale(e,t,i){let r=this.getMaxScale(),s=this.getMinScale(),o=i*this._tr[0];o<s?this._tr[0]>0&&(i=s/this._tr[0]):o>r&&this._tr[0]>0&&(i=r/this._tr[0]);let n=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,e,t,0,1]),u=new Float32Array([i,0,0,0,0,i,0,0,0,0,1,0,0,0,0,1]),m=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,-e,-t,0,1]);A.multiply(m,this._tr,this._tr),A.multiply(u,this._tr,this._tr),A.multiply(n,this._tr,this._tr)}setScreenRect(e,t,i,r){this._screenLeft=e,this._screenRight=t,this._screenBottom=i,this._screenTop=r}setMaxScreenRect(e,t,i,r){this._maxLeft=e,this._maxRight=t,this._maxTop=r,this._maxBottom=i}setMaxScale(e){this._maxScale=e}setMinScale(e){this._minScale=e}getMaxScale(){return this._maxScale}getMinScale(){return this._minScale}isMaxScale(){return this.getScaleX()>=this._maxScale}isMinScale(){return this.getScaleX()<=this._minScale}getScreenLeft(){return this._screenLeft}getScreenRight(){return this._screenRight}getScreenBottom(){return this._screenBottom}getScreenTop(){return this._screenTop}getMaxLeft(){return this._maxLeft}getMaxRight(){return this._maxRight}getMaxBottom(){return this._maxBottom}getMaxTop(){return this._maxTop}},zn;(e=>e.CubismViewMatrix=bt)(zn||={});var ai=class{constructor(){this._startX=0,this._startY=0,this._lastX=0,this._lastY=0,this._lastX1=0,this._lastY1=0,this._lastX2=0,this._lastY2=0,this._lastTouchDistance=0,this._deltaX=0,this._deltaY=0,this._scale=1,this._touchSingle=!1,this._flipAvailable=!1}getCenterX(){return this._lastX}getCenterY(){return this._lastY}getDeltaX(){return this._deltaX}getDeltaY(){return this._deltaY}getStartX(){return this._startX}getStartY(){return this._startY}getScale(){return this._scale}getX(){return this._lastX}getY(){return this._lastY}getX1(){return this._lastX1}getY1(){return this._lastY1}getX2(){return this._lastX2}getY2(){return this._lastY2}isSingleTouch(){return this._touchSingle}isFlickAvailable(){return this._flipAvailable}disableFlick(){this._flipAvailable=!1}touchesBegan(e,t){this._lastX=e,this._lastY=t,this._startX=e,this._startY=t,this._lastTouchDistance=-1,this._flipAvailable=!0,this._touchSingle=!0}touchesMoved(e,t){this._lastX=e,this._lastY=t,this._lastTouchDistance=-1,this._touchSingle=!0}getFlickDistance(){return this.calculateDistance(this._startX,this._startY,this._lastX,this._lastY)}calculateDistance(e,t,i,r){return Math.sqrt((e-i)*(e-i)+(t-r)*(t-r))}calculateMovingAmount(e,t){if(e>0!=t>0)return 0;let i=e>0?1:-1,r=Math.abs(e),s=Math.abs(t);return i*(r<s?r:s)}};var ni=class{constructor(){this._programId=null,this._back=null,this._gear=null,this._touchManager=new ai,this._deviceToScreen=new A,this._viewMatrix=new bt}initialize(){let{width:e,height:t}=F,i=e/t,r=-i,s=i,o=ki,n=Ui;if(this._viewMatrix.setScreenRect(r,s,o,n),this._viewMatrix.scale(li,li),this._deviceToScreen.loadIdentity(),e>t){let u=Math.abs(s-r);this._deviceToScreen.scaleRelative(u/e,-u/e)}else{let u=Math.abs(n-o);this._deviceToScreen.scaleRelative(u/t,-u/t)}this._deviceToScreen.translateRelative(-e*.5,-t*.5),this._viewMatrix.setMaxScale(Oi),this._viewMatrix.setMinScale(Ni),this._viewMatrix.setMaxScreenRect(zi,$i,Gi,Hi)}release(){this._viewMatrix=null,this._touchManager=null,this._deviceToScreen=null,f.deleteProgram(this._programId),this._programId=null}render(){f.useProgram(this._programId),this._back&&this._back.render(this._programId),this._gear&&this._gear.render(this._programId),f.flush();let e=J.getInstance();e.setViewMatrix(this._viewMatrix),e.onUpdate()}initializeSprite(){let e=F.width,t=F.height,i=w.getInstance().getTextureManager(),r=Dt;this._programId==null&&(this._programId=w.getInstance().createShader())}onTouchesBegan(e,t){this._touchManager.touchesBegan(e*window.devicePixelRatio,t*window.devicePixelRatio)}onTouchesMoved(e,t){let i=this.transformViewX(this._touchManager.getX()),r=this.transformViewY(this._touchManager.getY());this._touchManager.touchesMoved(e*window.devicePixelRatio,t*window.devicePixelRatio),J.getInstance().onDrag(i,r)}onTouchesEnded(e,t){let i=J.getInstance();{let r=this._deviceToScreen.transformX(this._touchManager.getX()),s=this._deviceToScreen.transformY(this._touchManager.getY());Ki&&E.printMessage(`[APP]touchesEnded x: ${r} y: ${s}`),i.onTap(r,s)}}transformViewX(e){let t=this._deviceToScreen.transformX(e);return this._viewMatrix.invertTransformX(t)}transformViewY(e){let t=this._deviceToScreen.transformY(e);return this._viewMatrix.invertTransformY(t)}transformScreenX(e){return this._deviceToScreen.transformX(e)}transformScreenY(e){return this._deviceToScreen.transformY(e)}};var Re=null,ri=null,w=class a{static getInstance(){return Re==null&&(Re=new a),Re}static releaseInstance(){Re?.release(),Re=null}initialize(){return Lt==="auto"?this._resizeCanvas():(F.width=Lt.width,F.height=Lt.height),ri||(ri=f.getParameter(f.FRAMEBUFFER_BINDING)),f.enable(f.BLEND),f.blendFunc(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA),"ontouchend"in F?(F.addEventListener("touchstart",Xn,{passive:!0}),F.addEventListener("touchmove",Wn,{passive:!0}),F.addEventListener("touchend",Yn,{passive:!0}),F.addEventListener("touchcancel",qn,{passive:!0})):(window.addEventListener("mousemove",Gn,{passive:!0}),F.addEventListener("mouseup",Hn,{passive:!0})),this._view.initialize(),this.initializeCubism(),!0}onResize(){this._resizeCanvas(),this._view.initialize(),this._view.initializeSprite()}release(){this._textureManager.release(),this._textureManager=null,this._view.release(),this._view=null,J.releaseInstance(),v.dispose()}run(){let e=()=>{Re!=null&&(E.updateTime(),f.clearColor(0,0,0,0),f.enable(f.DEPTH_TEST),f.depthFunc(f.LEQUAL),f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT),f.clearDepth(1),f.enable(f.BLEND),f.blendFunc(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA),this._view.render(),requestAnimationFrame(e))};e()}createShader(){let e=f.createShader(f.VERTEX_SHADER);if(e==null)return E.printMessage("failed to create vertexShader"),null;f.shaderSource(e,"precision mediump float;attribute vec3 position;attribute vec2 uv;varying vec2 vuv;void main(void){   gl_Position = vec4(position, 1.0);   vuv = uv;}"),f.compileShader(e);let i=f.createShader(f.FRAGMENT_SHADER);if(i==null)return E.printMessage("failed to create fragmentShader"),null;f.shaderSource(i,"precision mediump float;varying vec2 vuv;uniform sampler2D texture;void main(void){   gl_FragColor = texture2D(texture, vuv);}"),f.compileShader(i);let s=f.createProgram();return f.attachShader(s,e),f.attachShader(s,i),f.deleteShader(e),f.deleteShader(i),f.linkProgram(s),f.useProgram(s),s}getView(){return this._view}getTextureManager(){return this._textureManager}getCanvasBlob(){return this._view.render(),new Promise((e,t)=>{try{F.toBlob(i=>{e(i)},"image/png",1)}catch(i){t(i)}})}constructor(){this._captured=!1,this._mouseX=0,this._mouseY=0,this._isEnd=!1,this._cubismOption=new Rt,this._view=new ni,this._textureManager=new si}initializeCubism(){this._cubismOption.logFunction=E.printMessage,this._cubismOption.loggingLevel=Qi,v.startUp(this._cubismOption),v.initialize(),J.getInstance(),E.updateTime(),this._view.initializeSprite()}_resizeCanvas(){F.width=F.clientWidth*window.devicePixelRatio,F.height=F.clientHeight*window.devicePixelRatio,f.viewport(0,0,f.drawingBufferWidth,f.drawingBufferHeight)}};function Gn(a){if(!w.getInstance()._view){E.printMessage("view notfound");return}let e=F.getBoundingClientRect(),t=a.clientX-e.left,i=a.clientY-e.top;w.getInstance()._view.onTouchesMoved(t,i)}function Hn(a){if(w.getInstance()._captured=!1,!w.getInstance()._view){E.printMessage("view notfound");return}let e=a.target.getBoundingClientRect(),t=a.clientX-e.left,i=a.clientY-e.top;w.getInstance()._view.onTouchesEnded(t,i)}function Xn(a){if(!w.getInstance()._view){E.printMessage("view notfound");return}w.getInstance()._captured=!0;let e=a.changedTouches[0].pageX,t=a.changedTouches[0].pageY;w.getInstance()._view.onTouchesBegan(e,t)}function Wn(a){if(!w.getInstance()._view){E.printMessage("view notfound");return}let e=a.target.getBoundingClientRect(),t=a.changedTouches[0].clientX-e.left,i=a.changedTouches[0].clientY-e.top;w.getInstance()._view.onTouchesMoved(t,i)}function Yn(a){if(w.getInstance()._captured=!1,!w.getInstance()._view){E.printMessage("view notfound");return}let e=a.target.getBoundingClientRect(),t=a.changedTouches[0].clientX-e.left,i=a.changedTouches[0].clientY-e.top;w.getInstance()._view.onTouchesEnded(t,i)}function qn(a){if(w.getInstance()._captured=!1,!w.getInstance()._view){E.printMessage("view notfound");return}let e=a.target.getBoundingClientRect(),t=a.changedTouches[0].clientX-e.left,i=a.changedTouches[0].clientY-e.top;w.getInstance()._view.onTouchesEnded(t,i)}window.live2d=window.live2d||{};window.live2d.init=a=>{!kt.getInstance()||!w.getInstance().initialize()||w.getInstance().run()};window.live2d.loadModel=a=>{J.getInstance().loadModel(a)};window.live2d.randomExpression=()=>{J.getInstance().randomExpression()};window.live2d.getCanvasBlob=()=>w.getInstance().getCanvasBlob();window.addEventListener("beforeunload",()=>w.releaseInstance(),{passive:!0});})();
